/*!
 * OpenUI5
 * (c) Copyright 2026 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Element","sap/ui/base/Object","sap/ui/base/ManagedObject","sap/ui/base/ManagedObjectObserver","sap/m/IconTabFilter","sap/m/IconTabHeader","sap/m/library","./library","sap/uxap/ObjectPageSection"],function(e,t,o,r,n,a,i,s,c){"use strict";var u=i.TabsOverflowMode;var g=i.IconTabHeaderMode;var h=s.ObjectPageSubSectionLayout;var f=t.extend("sap.uxap._helpers.AB",{constructor:function(e){this._oObjectPageLayout=e;this._oObserver=new r(this._proxyStateChanges.bind(this))},getInterface:function(){return this}});f._focusSection=function(e,t){var o=e.getDomRef();if(o){o.focus(t)}};f.prototype.getObjectPageLayout=function(){return this._oObjectPageLayout};f.prototype._getAnchorBar=function(){var e=this.getObjectPageLayout(),t=e.getAggregation("_anchorBar"),r=e.getUpperCaseAnchorBar();if(!t){t=new a({id:e.getId()+"-anchBar",tabsOverflowMode:u.StartAndEnd,backgroundDesign:o.escapeSettingsValue(e.getBackgroundDesignAnchorBar()),mode:g.Inline});t.attachSelect(function(t){var o=t.getParameter("key");this._moveFocusOnSection(o);e.onAnchorBarTabPress(o)}.bind(this));t.addEventDelegate({onAfterRendering:function(){e._adjustTitlePositioning();this._clearAnchorBarFixedHeight(t)}.bind(this)});if(r){t.addStyleClass("sapUxAPAnchorBarUpperCase")}this.getObjectPageLayout().setAggregation("_anchorBar",t,true)}return t};f.prototype._fixAnchorBarHeight=function(e){var t=e.getDomRef()?.parentNode;if(t){t.style.height=t.clientHeight+"px"}};f.prototype._clearAnchorBarFixedHeight=function(e){var t=e.getDomRef()?.parentNode;if(t){t.style.height="auto"}};f.prototype._buildAnchorBar=function(){var e=this.getObjectPageLayout(),t=this._getAnchorBar(),r=e.getUpperCaseAnchorBar();this.resetControl();this._oObserver.disconnect();e._getVisibleSections().forEach(function(a){var i=t.getId()+"-"+a.getId()+"-anchor",s=new n(i,{text:o.escapeSettingsValue(a._getTitle()),key:a.getId(),iconColor:o.escapeSettingsValue(a.getAnchorBarButtonColor())}),c=a._getVisibleSubSections();this._setupCustomButtonForwarding(a,s,r);if(e.getShowAnchorBarPopover()){if(c.length>1){c.forEach(function(e){var r=t.getId()+"-"+e.getId()+"-anchor",a=new n(r,{text:o.escapeSettingsValue(e.getTitle()),key:e.getId()});s.addItem(a);this._setupCustomButtonForwarding(e,a)},this)}else if(c.length===1&&!a.getCustomAnchorBarButton()&&c[0].getTitle()?.trim()){e.getSubSectionLayout()===h.TitleOnLeft&&s.setText(o.escapeSettingsValue(c[0].getTitle()));this._setupCustomButtonForwarding(c[0],s,r)}}t.addItem(s)},this);e.setAggregation("_anchorBar",t)};f.prototype._setupCustomButtonForwarding=function(e,t,o){var r=e.getCustomAnchorBarButton();if(!r){return}t.setText(r.getText());t.setIcon(r.getIcon());this._oObserver.observe(r,{properties:true});this._getAnchorBar().attachSelect(function(e){this._forwardPressToCustomButton(e.getParameter("item"))},this)};f.prototype._forwardPressToCustomButton=function(t){var o=t.getKey(),r=e.getElementById(o),n=r?.getCustomAnchorBarButton();if(n){n.firePress()}};f.prototype.resetControl=function(){var e=this._getAnchorBar();this._fixAnchorBarHeight(e);e.destroyItems()};f.prototype.selectAnchorForSection=function(e){var t=sap.ui.getCore().byId(e),o;if(!t){return}o=t.isA("sap.uxap.ObjectPageSubSection");if(o){e=t.getParent().getId()}this._getAnchorBar().setSelectedKey(e)};f.prototype._setAnchorButtonsTabFocusValues=function(e){var t=this._getAnchorBar().getItems(),o,r="0",n="-1",a="tabIndex";t.forEach(function(t){o=t.$();if(t.getKey()===e){o.attr(a,r)}else{o.attr(a,n)}})};f.prototype._moveFocusOnSection=function(t){var o=e.getElementById(t),r,n,a={preventScroll:true},i;if(!o){return}if(!o.isActive()){i={onAfterRendering:function(){o.removeEventDelegate(i);f._focusSection(o,a)}};o.addEventDelegate(i);return}r=c._getClosestSection(o);n=this._getAnchorBar().getItems().find(e=>e.getKey()===r.getId());if(document.activeElement!==n.getDomRef()){i={onfocusin:function(){n.removeEventDelegate(i);f._focusSection(o,a)}};n.addEventDelegate(i)}f._focusSection(o,a)};f.prototype._proxyStateChanges=function(e){var t=e.object,o=t.getParent(),r=this._findAnchorForSectionBase(o),n=e.name,a=e.current,i="set"+p(n);if(r){r[i].call(r,a)}};f.prototype._findAnchorForSectionBase=function(e){var t=e?.getId(),o=this._getAnchorBar(),r=o.getItems(),n,a=function(e){return e.some(function(e){if(e.getKey()===t){n=e;return true}return a(e.getItems())})};a(r);return n};function p(e){return e.substring(0,1).toUpperCase()+e.substring(1)}return f});
//# sourceMappingURL=ObjectPageLayoutABHelper.js.map