/*!
 * OpenUI5
 * (c) Copyright 2026 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Element","sap/ui/core/Lib","sap/ui/core/library","sap/ui/base/Object","sap/ui/base/ManagedObject","sap/ui/base/ManagedObjectObserver","sap/m/IconTabFilter","sap/m/IconTabHeader","sap/m/library","./library","sap/uxap/ObjectPageSection"],function(e,t,o,r,n,a,i,s,c,u,g){"use strict";var h=c.TabsOverflowMode;var f=c.IconTabHeaderMode;var p=u.ObjectPageSubSectionLayout;var l=r.extend("sap.uxap._helpers.AB",{constructor:function(e){this._oObjectPageLayout=e;this._oObserver=new a(this._proxyStateChanges.bind(this))},getInterface:function(){return this}});l._focusSection=function(e,t){var o=e.getDomRef();if(o){o.focus(t)}};l.prototype.getObjectPageLayout=function(){return this._oObjectPageLayout};l.prototype._getAnchorBar=function(){var e=this.getObjectPageLayout(),t=e.getAggregation("_anchorBar"),o=e.getUpperCaseAnchorBar();if(!t){t=new s({id:e.getId()+"-anchBar",tabsOverflowMode:h.StartAndEnd,backgroundDesign:n.escapeSettingsValue(e.getBackgroundDesignAnchorBar()),mode:f.Inline});t.attachSelect(function(t){var o=t.getParameter("key");this._moveFocusOnSection(o);e.onAnchorBarTabPress(o)}.bind(this));t.addEventDelegate({onAfterRendering:function(){e._adjustTitlePositioning();this._clearAnchorBarFixedHeight(t)}.bind(this)});if(o){t.addStyleClass("sapUxAPAnchorBarUpperCase")}this.getObjectPageLayout().setAggregation("_anchorBar",t,true)}return t};l.prototype._fixAnchorBarHeight=function(e){var t=e.getDomRef()?.parentNode;if(t){t.style.height=t.clientHeight+"px"}};l.prototype._clearAnchorBarFixedHeight=function(e){var t=e.getDomRef()?.parentNode;if(t){t.style.height="auto"}};l.prototype._setLandmarkInfo=function(e){this._oLandmarkInfo=e;this._applyAriaAttributes()};l.prototype._applyAriaAttributes=function(){var e=this._getAnchorBar().$(),r=this.getObjectPageLayout(),n=r._formatLandmarkInfo(this._oLandmarkInfo,"Navigation"),a=t.getResourceBundleFor("sap.uxap");if(n.role){e.attr("role",n.role)}else if(n.role===""){e.removeAttr("role")}if(n.label){e.attr("aria-label",n.label)}else if(this._oLandmarkInfo?.getNavigationRole()!==o.AccessibleLandmarkRole.None){e.attr("aria-label",a.getText("NAVIGATION_ROLE_DESCRIPTION"))}};l.prototype._buildAnchorBar=function(){var e=this.getObjectPageLayout(),t=this._getAnchorBar(),o=e.getUpperCaseAnchorBar();this.resetControl();this._oObserver.disconnect();e._getVisibleSections().forEach(function(r){var a=t.getId()+"-"+r.getId()+"-anchor",s=new i(a,{text:n.escapeSettingsValue(r._getTitle()),key:r.getId(),iconColor:n.escapeSettingsValue(r.getAnchorBarButtonColor())}),c=r._getVisibleSubSections();this._setupCustomButtonForwarding(r,s,o);if(e.getShowAnchorBarPopover()){if(c.length>1){c.forEach(function(e){var o=t.getId()+"-"+e.getId()+"-anchor",r=new i(o,{text:n.escapeSettingsValue(e.getTitle()),key:e.getId()});s.addItem(r);this._setupCustomButtonForwarding(e,r)},this)}else if(c.length===1&&!r.getCustomAnchorBarButton()&&c[0].getTitle()?.trim()){e.getSubSectionLayout()===p.TitleOnLeft&&s.setText(n.escapeSettingsValue(c[0].getTitle()));this._setupCustomButtonForwarding(c[0],s,o)}}t.addItem(s)},this);e.setAggregation("_anchorBar",t)};l.prototype._setupCustomButtonForwarding=function(e,t,o){var r=e.getCustomAnchorBarButton();if(!r){return}t.setText(r.getText());t.setIcon(r.getIcon());this._oObserver.observe(r,{properties:true});this._getAnchorBar().attachSelect(function(e){this._forwardPressToCustomButton(e.getParameter("item"))},this)};l.prototype._forwardPressToCustomButton=function(t){var o=t.getKey(),r=e.getElementById(o),n=r?.getCustomAnchorBarButton();if(n){n.firePress()}};l.prototype.resetControl=function(){var e=this._getAnchorBar();this._fixAnchorBarHeight(e);e.destroyItems()};l.prototype.selectAnchorForSection=function(e){var t=sap.ui.getCore().byId(e),o;if(!t){return}o=t.isA("sap.uxap.ObjectPageSubSection");if(o){e=t.getParent().getId()}this._getAnchorBar().setSelectedKey(e)};l.prototype._setAnchorButtonsTabFocusValues=function(e){var t=this._getAnchorBar().getItems(),o,r="0",n="-1",a="tabIndex";t.forEach(function(t){o=t.$();if(t.getKey()===e){o.attr(a,r)}else{o.attr(a,n)}})};l.prototype._moveFocusOnSection=function(t){var o=e.getElementById(t),r,n,a={preventScroll:true},i;if(!o){return}if(!o.isActive()){i={onAfterRendering:function(){o.removeEventDelegate(i);l._focusSection(o,a)}};o.addEventDelegate(i);return}r=g._getClosestSection(o);n=this._getAnchorBar().getItems().find(e=>e.getKey()===r.getId());if(document.activeElement!==n.getDomRef()){i={onfocusin:function(){n.removeEventDelegate(i);l._focusSection(o,a)}};n.addEventDelegate(i)}l._focusSection(o,a)};l.prototype._proxyStateChanges=function(e){var t=e.object,o=t.getParent(),r=this._findAnchorForSectionBase(o),n=e.name,a=e.current,i="set"+d(n);if(r){r[i].call(r,a)}};l.prototype._findAnchorForSectionBase=function(e){var t=e?.getId(),o=this._getAnchorBar(),r=o.getItems(),n,a=function(e){return e.some(function(e){if(e.getKey()===t){n=e;return true}return a(e.getItems())})};a(r);return n};function d(e){return e.substring(0,1).toUpperCase()+e.substring(1)}return l});
//# sourceMappingURL=ObjectPageLayoutABHelper.js.map