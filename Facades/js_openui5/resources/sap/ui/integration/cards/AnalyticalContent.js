/*!
 * OpenUI5
 * (c) Copyright 2026 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./AnalyticalContentRenderer","./BaseContent","sap/f/cards/loading/AnalyticalPlaceholder","sap/m/IllustratedMessageType","sap/ui/core/Lib","sap/ui/integration/library","sap/ui/integration/util/BindingResolver","sap/ui/model/json/JSONModel","sap/base/Log","sap/base/util/merge"],function(t,e,a,i,n,o,r,s,c,l){"use strict";var p=o.CardActionArea;var u,d,h,g,v,f,y;var m={Top:"top",Bottom:"bottom",Left:"left",Right:"right"};var _={TopLeft:"topLeft",Center:"center"};var b={Left:"left",Center:"center",Right:"right"};var A={Line:"line",StackedColumn:"stacked_column",StackedBar:"stacked_bar",Donut:"donut"};var C={Chart:"Chart",Full:"Full"};var P=e.extend("sap.ui.integration.cards.AnalyticalContent",{metadata:{library:"sap.ui.integration"},renderer:t});P.prototype.exit=function(){e.prototype.exit.apply(this,arguments);if(this._oPopover){this._oPopover.destroy()}};P.prototype.applyConfiguration=function(){var t=this.getParsedConfiguration();if(!t){return}this._createChart()};P.prototype.createLoadingPlaceholder=function(e){return new a({chartType:e.chartType,minHeight:this.getOverflowWithShowMore()?0:t.getMinHeight(e)})};P.prototype.loadDependencies=function(t){return new Promise(function(t,e){n.load("sap.viz").then(function(){sap.ui.require(["sap/viz/ui5/controls/VizFrame","sap/viz/ui5/controls/common/feeds/FeedItem","sap/viz/ui5/controls/Popover","sap/viz/ui5/data/FlattenedDataset","sap/viz/ui5/data/MeasureDefinition","sap/viz/ui5/data/DimensionDefinition","sap/viz/ui5/controls/VizTooltip"],function(e,a,i,n,o,r,s){u=e;d=a;g=i;h=n;v=o;f=r;y=s;t()},function(t){e(t)})}).catch(function(){e("Analytical content type is not available with this distribution.")})})};P.prototype.onDataChanged=function(){this._updateChart();var t=this.getAggregation("_content");if(t){var e=t._getVizDataset(),a=e&&e._FlatTableD&&e._FlatTableD._data&&Array.isArray(e._FlatTableD._data)&&e._FlatTableD._data.length;if(a){this.hideNoDataMessage()}else{this.showNoDataMessage({illustrationType:i.NoData,title:n.getResourceBundleFor("sap.ui.integration").getText("CARD_NO_ITEMS_ERROR_LISTS")})}}};P.prototype._createChart=function(){var t=this.getParsedConfiguration();if(!t.chartType){c.error('"sap.card".content.chartType is mandatory property.',null,"sap.ui.integration.widgets.Card");return}var e=r.resolveValue(t,this,"/");var a=new u({uiConfig:{applicationSet:"fiori"},height:"100%",width:"100%",vizType:A[e.chartType]||e.chartType});if(e.tooltips){(new y).connect(a.getVizUid())}this.setAggregation("_content",a);this._attachActions(t);if(e.popover&&e.popover.active){this._attachPopover()}};P.prototype._supportsOverflow=function(){return false};P.prototype._updateChart=function(){var t=this.getParsedConfiguration();var e=this.getAggregation("_content");var a=r.resolveValue(t,this,"/");if(!e){return}e.destroyDataset().destroyFeeds();e.applySettings({vizProperties:this._getVizProperties(a),dataset:this._getDataset(t,a),feeds:this._getFeeds(a),vizType:A[a.chartType]||a.chartType});this._onChartFullyLoaded(e)};P.prototype._onChartFullyLoaded=function(t){if(!this._bChartHandlersAttached){const e=this.getCardInstance();t.attachRenderComplete(function(){const a=t.getDomRef();if(!a){return}const i=a.querySelector("svg");if(!i){return}if(!this._bActions&&!this._bPopover&&this.getCardInstance().isRoleListItem()){const t=e.getDomRef().getAttribute("aria-describedby");const a=i.getAttribute("aria-labelledby");i.setAttribute("tabindex","");i.setAttribute("focusable","false");if(t&&!t.endsWith(a)){e.getDomRef().setAttribute("aria-describedby",t+" "+a)}else if(!t){e.getDomRef().setAttribute("aria-describedby",a)}if(e.isInteractive()){i.classList.add("sapUiIntegrationAnalyticalForcePointer")}}else if(this._bActions&&!this._bChartsInteractive){i.classList.add("sapUiIntegrationAnalyticalForcePointer")}}.bind(this));this._bChartHandlersAttached=true}};P.prototype._attachActions=function(t){var e={area:p.Content,actions:t.actions,control:this};if(t.actionableArea===C.Chart){e.eventName="selectData";e.actionControl=this.getAggregation("_content");this._oActions.setBindingPathResolver(t=>{const e=this._getContextPath(t);return e});this._oActions.setParametersResolver((t,e,a,i)=>{if(e.getModel("chartEventData")){c.error("Model 'chartEventData' is already in use. Chart event data binding will not work correctly.");return r.resolveValue(t.parameters,e,a)}const n=this._prepareChartEventData(i);if(!n){return r.resolveValue(t.parameters,e,a)}const o=new s(n);e.setModel(o,"chartEventData");const l=r.resolveValue(t.parameters,e,a);e.setModel(null,"chartEventData");return l})}else{e.eventName="press"}this._oActions.attach(e)};P.prototype._attachPopover=function(){if(this._oPopover){this._oPopover.destroy()}this._oPopover=new g;this._oPopover.connect(this.getAggregation("_content").getVizUid());const t=this.getParsedConfiguration();const e=t.popover.actionsStrip;if(e&&e[0]?.actions?.length){const t=e[0];const a=this.getAggregation("_content");a.attachSelectData(e=>{const i=this._getContextPath(e);const n=r.resolveValue(t,this,i);this._oPopover.setActionItems([{type:"action",text:n.text,press:()=>{this._oActions.fireAction(a,n.actions[0].type,n.actions[0].parameters)}}])})}};P.prototype._getVizProperties=function(t){if(!t){return null}var e=t.title,a=t.legend,i=t.plotArea;var n={title:{style:{fontWeight:"normal"},layout:{respectPlotPosition:false}},legend:{},legendGroup:{layout:{}},plotArea:{window:{start:"firstDataPoint",end:"lastDataPoint"}},categoryAxis:{title:{}},valueAxis:{title:{}},interaction:{noninteractiveMode:true}};if(t.actions||t.popover||t.tooltips){this._bChartsInteractive=t.actionableArea===C.Chart||t.popover?.active||t.tooltips;this._bActions=t.actions;this._bPopover=t.popover&&t.popover.active;n.interaction.noninteractiveMode=!this._bChartsInteractive}if(t.popover&&t.tooltips){c.error('"sap.card".content.popover property and "sap.card".content.tooltips property shouldn\'t be set at the same time. Only the popover will work.',null,"sap.ui.integration.widgets.Card")}if(e){n.title.text=e.text;n.title.visible=e.visible;n.title.alignment=b[e.alignment];c.warning('"sap.card".content.title is deprecated. Use "sap.card".content.chartProperties instead',null,"sap.ui.integration.widgets.Card")}if(a){n.legend.visible=a.visible;n.legendGroup.layout.position=m[a.position];n.legendGroup.layout.alignment=_[a.alignment];c.warning('"sap.card".content.legend is deprecated. Use "sap.card".content.chartProperties instead',null,"sap.ui.integration.widgets.Card")}if(i){if(i.dataLabel){n.plotArea.dataLabel=i.dataLabel}if(i.categoryAxisText){n.categoryAxis.title.visible=i.categoryAxisText.visible}if(i.valueAxisText){n.valueAxis.title.visible=i.valueAxisText.visible}c.warning('"sap.card".content.plotArea is deprecated. Use "sap.card".content.chartProperties instead',null,"sap.ui.integration.widgets.Card")}l(n,t.chartProperties);return n};P.prototype._getDataset=function(t,e){var a,i;if(t.dimensions){i=t.dimensions.map(function(t,a){return new f({name:e.dimensions[a].name||e.dimensions[a].label,value:t.value,displayValue:t.displayValue,dataType:t.dataType})})}if(t.measures){a=t.measures.map(function(t,a){return new v({name:e.measures[a].name||e.measures[a].label,value:t.value})})}return new h({measures:a,dimensions:i,data:{path:this.getBindingContext().getPath()}})};P.prototype._getFeeds=function(t){var e=t.feeds;if(t.measureAxis||t.dimensionAxis){c.warning('"sap.card".content.measureAxis and "sap.card".content.dimensionAxis are deprecated. Use "sap.card".content.feeds instead',null,"sap.ui.integration.widgets.Card");e=[{uid:t.measureAxis,type:"Measure",values:t.measures.map(function(t){return t.label})},{uid:t.dimensionAxis,type:"Dimension",values:t.dimensions.map(function(t){return t.label})}]}return e.map(function(t){return new d(t)})};P.prototype._getContextPath=function(t){const e=t.getParameter("data")[0].data;const a=e._context_row_number;const i=this.getBindingContext().getPath();const n=i!=="/"?i+"/"+a:i+a;return n};P.prototype._prepareChartEventData=function(t){if(!t){return null}const e=t.getParameter("data");const a=[];e.forEach(function(t){const e=t.data;const i={};for(const t in e){if(e.hasOwnProperty(t)&&!t.startsWith("_")){i[t]=e[t]}}a.push(i)});return a};P.prototype.getFocusDomRef=function(){return this.getAggregation("_content").getDomRef().querySelector(".v-m-root")||this.getDomRef()};return P});
//# sourceMappingURL=AnalyticalContent.js.map