/*!
 * OpenUI5
 * (c) Copyright 2026 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/i18n/Localization","sap/ui/core/Control","sap/ui/core/Core","sap/base/util/deepClone","sap/base/util/deepEqual","sap/base/util/merge","sap/ui/base/Interface","sap/ui/core/Element","sap/ui/core/Lib","sap/ui/integration/Designtime","sap/ui/model/json/JSONModel","sap/ui/model/odata/v4/ODataModel","sap/ui/integration/util/Utils","sap/ui/integration/util/Destinations","sap/ui/integration/util/DataProviderFactory","sap/m/Label","sap/m/HBox","sap/m/VBox","sap/ui/core/Icon","sap/m/ResponsivePopover","sap/m/Popover","sap/m/Text","sap/base/Log","sap/ui/core/Popup","sap/base/i18n/ResourceBundle","sap/ui/integration/editor/EditorResourceBundles","sap/ui/dom/includeStylesheet","sap/base/util/LoaderExtensions","sap/ui/core/theming/Parameters","sap/base/util/ObjectPath","sap/m/FormattedText","sap/m/MessageStrip","sap/m/ToolbarSpacer","sap/ui/model/resource/ResourceModel","./Manifest","./Merger","./Settings","./Constants","sap/m/FlexItemData","sap/m/FlexBox","sap/m/Button","sap/ui/core/UIArea","sap/m/Tree","sap/m/StandardTreeItem"],function(e,t,i,a,n,s,r,o,l,d,f,u,g,h,p,c,_,m,v,y,b,C,I,T,D,E,S,M,x,P,A,O,R,L,w,B,F,N,U,V,j,k,W,H){"use strict";var q=b.prototype.init;b.prototype.init=function(){q.apply(this,arguments);var e=this.oPopup._applyPosition,t=this;this.oPopup._applyPosition=function(){var i=t.close;t.close=function(){};e.apply(this,arguments);t.close=i}};function G(e){if(e&&e.nodeType!==1){return 0}var t=parseInt(window.getComputedStyle(e).getPropertyValue("z-index"));if(isNaN(t)){return G(e.parentNode)}return t+1}var K=/\{\{(?!parameters.)(?!destinations.)([^\}\}]+)\}\}/g,J=/\{\{parameters\.([^\}\}]+)/g,z=5e3,X="_strip",Y="module:",Z;var Q=t.extend("sap.ui.integration.editor.Editor",{metadata:{library:"sap.ui.integration",properties:{mode:{type:"string",defaultValue:N.EDITOR_MODE.ADMIN},language:{type:"string",defaultValue:""},allowDynamicValues:{type:"boolean",defaultValue:false},allowSettings:{type:"boolean",defaultValue:false},designtime:{type:"object"},section:{type:"string",defaultValue:"sap.card"},host:{type:"string",defaultValue:""},baseUrl:{type:"sap.ui.core.URI",defaultValue:null},json:{type:"object"},previewPosition:{type:"string",defaultValue:"right"},width:{type:"sap.ui.core.CSSSize",defaultValue:""},height:{type:"sap.ui.core.CSSSize",defaultValue:""}},aggregations:{_formContent:{type:"sap.ui.core.Control",multiple:true,visibility:"hidden"},_preview:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"},_messageStrip:{type:"sap.m.MessageStrip",multiple:false,visibility:"hidden"},_extension:{type:"sap.ui.integration.editor.Extension",multiple:false,visibility:"hidden"}},events:{manifestReady:{},fieldReady:{},destinationReady:{},UIReady:{},ready:{}}},renderer:{apiVersion:2,render:function(e,t){var i=t.getAggregation("_preview");var a=t.getMode()!==N.EDITOR_MODE.TRANSLATION&&t.hasPreview();var s=t.getPreviewPosition();if(a&&(s==="top"||s==="bottom")){e.openStart("div",t);e.openEnd();if(t.isFieldReady()&&s==="top"){e.renderControl(i)}}if(a&&s==="left"){e.openStart("div",t);e.class("sapUiIntegrationEditor");e.openEnd();if(t.isFieldReady()){e.renderControl(i)}}else if(a&&(s==="top"||s==="bottom")){e.openStart("div");e.class("sapUiIntegrationEditor");e.openEnd()}else{e.openStart("div",t);e.class("sapUiIntegrationEditor");e.openEnd()}var r=t.getId()+"_childsTreeContainer";var l;var d;if(t.isFieldReady()&&t._oChildTree){l=false;e.openStart("div",r);e.class("childsTreeContainer");e.openEnd();e.close("div");var f=new Promise(e=>{const t=new MutationObserver((t,i)=>{const a=document.getElementById(r);if(a){i.disconnect();e(a)}});t.observe(document.body,{childList:true,subtree:true})});d=f.then(e=>{var i=k.create(r);i.addContent(t._oChildTree);var a=new Promise(function(e,i){setTimeout(function(){if(t._oChildTree._itemIndex){var i=t._oChildTree.getItems().find(function(e){return e.getBindingContext().getPath()===t._oChildTree._itemIndex});if(i){i.focus();if(!i.isLeaf()&&!i.getExpanded()){t._oChildTree.expand(t._oChildTree.indexOfItem(i))}}}else{t._oChildTree.expand(0)}l=true;setTimeout(function(){e({})},100)},100)});return a})}if(t.isFieldReady()){e.openStart("div");e.class("sapUiIntegrationEditorForm");if(t.getMode()!==N.EDITOR_MODE.TRANSLATION){e.class("settingsButtonSpace")}e.openEnd();if(t.getMode()!==N.EDITOR_MODE.TRANSLATION){e.renderControl(t.getAggregation("_messageStrip"))}var u=t.getAggregation("_formContent");if(u){var g;var h;var p;var c;var v=[];var y=[];var b;var C=function(){if(v.length>0){var e=2-v.length;for(var t=0;t<e;t++){v.push(new m)}g.addContent(new V({alignItems:"Start",justifyContent:"SpaceBetween",items:v}));v=[]}};var I=function(){if(y.length>0){var e=2-y.length;for(var t=0;t<e;t++){y.push(new m)}h.addContent(new V({alignItems:"Start",justifyContent:"SpaceBetween",items:y}));y=[]}};var T=function(t){if(t.getContent().length>0){var i=t.getContent();if(i.length===1&&i[0].isA("sap.m.MessageStrip")){return}if(i[0].isA("sap.m.MessageStrip")){t.removeContent(0);t.addContent(i[0])}e.renderControl(t.getParent());if(t._messageStrip){e.renderControl(t._messageStrip)}}};var D=function(e,t){if(e&&t.getContent().length>0){var i=t.getContent();if(i[0].isA("sap.m.MessageStrip")){t.removeContent(0);t.addContent(i[0])}e.addContent(t.getParent());if(t._messageStrip){e.addContent(t._messageStrip)}}else{t=null}};var E=function(e,t){var i=e.getContent(),a;if(i.length>0){for(var n=0;n<i.length;n++){if(i[n].getAggregation("_field")&&i[n].getAggregation("_field").isA("sap.m.IconTabBar")){a=i[n].getAggregation("_field")}}}if(a&&t.getContent().length>0){a.addItem(t)}};for(var S=0;S<u.length;S++){var M=u[S];if(t.getMode()!==N.EDITOR_MODE.TRANSLATION){if(M.isA("sap.ui.integration.editor.fields.GroupField")){var x=M.getAggregation("_field");if(!x){continue}if(h){I();if(x.isA("sap.m.Panel")&&h.isA("sap.m.Panel")){D(g,h)}else{E(g,h)}}var P=0;if(x.isA("sap.m.Panel")){P=x._level}else if(x.isA("sap.m.IconTabBar")){P="1"}if(P==="1"){if(v.length>0){C()}if(x.isA("sap.m.IconTabBar")){var A=g.getContent(),O=false,R;if(A.length>0){for(var L=0;L<A.length;L++){if(A[L].getAggregation("_field")&&A[L].getAggregation("_field").isA("sap.m.IconTabBar")){O=true;R=A[L].getAggregation("_field")}}}h=x.getItems()[0];h._subItems=h._subItems||[];if(!O){x.removeItem(x.getItems()[0]);if(x._messageStrip){g.addContent(x._messageStrip)}x.addStyleClass("sapUiIntegrationEditorSubTab");g.addContent(M)}else{R.addItem(x.getItems()[0]);x.destroy()}}else{h=x;h._subItems=h._subItems||[]}}else{if(g){C();T(g);h=null}g=x;g._subItems=g._subItems||[];g.addStyleClass("sapUiIntegrationEditorItem")}if(S===u.length-1){C();T(g)}continue}if(M.isA("sap.m.FormattedText")){if(h){h.addContent(M.addStyleClass("sapUiIntegrationEditorHint"))}else{g.addContent(M.addStyleClass("sapUiIntegrationEditorHint"))}if(S===u.length-1){if(h){I();D(g,h)}C();T(g)}continue}var w=M._layout;if(M.isA("sap.m.Label")){M.addStyleClass("sapUiIntegrationEditorItemLabel");if(M.getRequired()){M.addStyleClass("sapUiIntegrationEditorItemLabelWithRequired")}if(w&&!n(w,{})){if(w.alignment&&w.alignment.label==="end"){M.setTextAlign("End")}c=M}else{if(M._cols===2){if(h){I()}else{C()}}else if(y.length===2){I()}else if(v.length===2){C()}if(h){h.addContent(M)}else{g.addContent(M)}}}else if(M.isA("sap.m.ToolbarSpacer")){if(M._hasLine){M.addStyleClass("sapUiIntegrationEditorSpacerWithLine")}else{M.addStyleClass("sapUiIntegrationEditorSpacerWithoutLine")}if(h){I();h.addContent(M)}else{C();g.addContent(M)}}else{var B=M.getConfiguration(),F=new _,j=.1,W=0,H;if(M._descriptionIcon){F.addItem(M._descriptionIcon);j+=.9}var q=o.getElementById(M.getAssociation("_messageIcon"));if(M.getAssociation("_messageIcon")&&q){F.addItem(q);j+=1.2}if(M._settingsButton){M._settingsButton.addStyleClass("sapUiIntegrationEditorSettingsButton");W=2}var G=new U({growFactor:10,maxWidth:"calc(100% - "+W+"rem)"});var K=new U({maxWidth:"calc(100% - "+j+"rem)"});if(c){var J,z,X="50%";if(w&&w["label-width"]){X=w["label-width"]}var Y=parseInt(X);var Z=100-Y;if(M._cols===2){Y=Y-.5;Z=Z-.5}if(w.alignment&&w.alignment.field==="end"){M.addStyleClass("sapUiIntegrationEditorFieldAlignEnd")}if(w.alignment&&w.alignment.label==="end"){c.setLayoutData(new U({maxWidth:"calc(100% - "+j+"rem)",minWidth:"calc(100% - "+j+"rem)"}))}else{c.setLayoutData(K)}if(F.getItems().length>0){c.addStyleClass("sapUiIntegrationEditorItemLabelWithInfo");H=new _({items:[c,F]})}else{H=c}if(w&&w.position&&w.position==="field-label"){H.setLayoutData(G);z=new _({alignItems:"Start",justifyContent:"SpaceBetween",items:[H,M._settingsButton]});z.setLayoutData(new U({growFactor:Y,maxWidth:Y+"%"}));M.setLayoutData(new U({growFactor:Z,maxWidth:Z+"%"}));J=new _({alignItems:"Start",justifyContent:"SpaceBetween",items:[M,z]})}else{M.setLayoutData(G);z=new _({alignItems:"Start",justifyContent:"SpaceBetween",items:[M,M._settingsButton]});H.setLayoutData(new U({growFactor:Y,maxWidth:Y+"%"}));z.setLayoutData(new U({growFactor:Z,maxWidth:Z+"%"}));J=new _({alignItems:"Start",justifyContent:"SpaceBetween",items:[H,z]})}if(M._cols===1){if(h){if(y.length===2){I()}if(B.hint){var Q=t._createHint(B.hint,M.getParameterId());var $=new m({items:[J,Q.addStyleClass("sapUiIntegrationEditorHint")]});$.addStyleClass("col1");y.push($)}else{J.addStyleClass("col1");y.push(J)}}else{if(v.length===2){C()}if(B.hint){var Q=t._createHint(B.hint,M.getParameterId());var $=new m({items:[J,Q.addStyleClass("sapUiIntegrationEditorHint")]});$.addStyleClass("col1");v.push($)}else{J.addStyleClass("col1");v.push(J)}}}else if(h){I();h.addContent(J)}else{C();g.addContent(J)}c=null}else{var ee;if(h){ee=h.getContent().pop()}else{ee=g.getContent().pop()}ee.setLayoutData(K);if(F.getItems().length>0){ee.addStyleClass("sapUiIntegrationEditorItemLabelWithInfo");H=new _({items:[ee,F]})}else{H=ee}H.setLayoutData(G);var te=new V({alignItems:"Start",justifyContent:"SpaceBetween",items:[H,M._settingsButton]});if(M._cols===1){var $=new m({items:[te,M]});if(B.hint){var Q=t._createHint(B.hint,M.getParameterId());$.addItem(Q.addStyleClass("sapUiIntegrationEditorHint"))}$.addStyleClass("col1");if(h){y.push($)}else{v.push($)}}else if(h){h.addContent(te);h.addContent(M)}else{g.addContent(te);g.addContent(M)}}if(h){h._subItems.push({settingspath:M.getConfiguration()._settingspath,itemId:M.getId()})}g._subItems.push({settingspath:M.getConfiguration()._settingspath,itemId:M.getId()})}if(S===u.length-1){if(h){I();if(h.isA("sap.m.Panel")){D(g,h)}else{E(g,h)}}C();T(g)}}else{if(S===0){p=M.getAggregation("_field");e.renderControl(M);M.addStyleClass("sapUiIntegrationEditorTranslationPanel");continue}if(M.isA("sap.ui.integration.editor.fields.GroupField")){var x=M.getAggregation("_field");if(h){if(x.isA("sap.m.Panel")&&h.isA("sap.m.Panel")){D(g,h)}else{E(g,h)}}var ie=0;if(x.isA("sap.m.Panel")){ie=x._level}else if(x.isA("sap.m.IconTabBar")){if(x.getItems().length>0&&x.getItems()[0]._level){ie=x.getItems()[0]._level}}if(ie==="1"){if(x.isA("sap.m.IconTabBar")){if(S!==u.length-1||S<u.length&&(u[S].isA("sap.m.IconTabBar")||u[S].isA("sap.m.Panel"))){var ae=g.getContent(),ne=false;if(ae.length>0){for(var se=0;se<ae.length;se++){if(ae[se].getAggregation("_field")&&ae[se].getAggregation("_field").isA("sap.m.IconTabBar")){ne=true}}}if(!ne){h=x.getItems()[0];x.removeItem(x.getItems()[0]);g.addContent(x.getParent())}else{h=x.getItems()[0]}}}else{h=x}}else{h=null;if(g&&g.getContent().length>0){p.addContent(g.getParent())}g=x}if(S===u.length-1){C();T(g)}continue}if(M.isA("sap.m.ToolbarSpacer")){continue}if(M.isA("sap.m.FormattedText")){continue}if(M.isA("sap.m.Label")){if(h){h.addContent(M)}else{g.addContent(M)}continue}if(M.isOrigLangField){b=M;continue}b.addStyleClass("sapUiIntegrationFieldTranslationText");var J=new _({items:[b,M]}).addStyleClass("notWrappingRow");if(h){h.addContent(J)}else{g.addContent(J)}if(S===u.length-1){if(h){if(h.isA("sap.m.Panel")){D(g,h)}else{E(g,h)}}p.addContent(g.getParent())}}}}e.close("div");if(a&&s==="right"){e.renderControl(i)}}e.close("div");if(a&&(s==="top"||s==="bottom")){if(s==="bottom"){e.renderControl(i)}e.close("div")}if(t.isFieldReady()&&!t.isReady()){t.fireUIReady();if(t._aFieldDataReadyPromise.length>0){Promise.all(t._aFieldDataReadyPromise).then(function(){t._aFieldDataReadyPromise=[];if(!t.isReady()){if(l===false&&d){d.then(function(){setTimeout(function(){t._ready=true;t.fireReady()},200)})}else{t._ready=true;t.fireReady()}}})}else if(l===false&&d){d.then(function(){setTimeout(function(){t._ready=true;t.fireReady()},200)})}else{t._ready=true;t.fireReady()}}}}});Q.prototype.init=function(){if(Q.oResourceBundle&&Q.oResourceBundle.sLocale!==g._language){Q.oResourceBundle=l.getResourceBundleFor("sap.ui.integration",g._language);this._applyLanguageChange()}this._fieldReady=false;this._ready=false;this._aFieldReadyPromise=[];this._aFieldDataReadyPromise=[];this._oResourceBundle=l.getResourceBundleFor("sap.ui.integration",g._language);this._aAppliedLayerChanges=[];this._oBeforeLayerChange={};this._oCurrentLayerChange={};this._mDestinationDataProviders={};var t=new O(this.getId()+X,{showIcon:false});t.addStyleClass("sapUiIntegrationEditorFieldMessageStrip");this.setAggregation("_messageStrip",t);X=t.getId();this.setLanguage(e.getLanguage());this._oLimitedInterface=new r(this,["getParameters","resolveDestination","request","getModel"])};Q.prototype.getParameters=function(){if(!this._isManifestReady){I.error("sap.ui.integration.editor.Editor: the manifest is not ready. Consider using the 'manifestReady' event.","sap.ui.integration.editor.Editor");return null}var e=this._oManifest.getProcessedParameters(),t={},i;for(i in e){t[i]=e[i].value}return t};Q.prototype.resolveDestination=function(e){return this._oDestinations.getUrl(e)};Q.prototype.isReady=function(){return this._ready};Q.prototype.isFieldReady=function(){return this._fieldReady};Q.prototype.hasPreview=function(){var e=this.getAggregation("_preview");if(e&&e.visible!==false){return true}return false};Q.prototype.getSeparatePreview=function(){var e=this.getPreviewPosition();if(!this.isFieldReady()||e!=="separate"){return null}if(!this._oPreview){this._oPreview=this.getAggregation("_preview")}return this._oPreview};Q.prototype.flattenData=function(e,t,i,a){a=a||"";i=i||[];if(typeof e==="object"){if(!e[t]){for(var n in e){this.flattenData(e[n],t,i,a+"/"+n)}}else{if(e.type){i.push({path:e.pathvalue||a.substring(1),value:e.pathvalue||"{context>"+a.substring(1)+"/value}",object:e})}else{i.push({path:a.substring(1),object:e});for(var n in e){this.flattenData(e[n],t,i,a+"/"+n)}}}}return i};Q.prototype.setJson=function(e,t){this._vIdOrSettings=a(e,500);this._fieldReady=false;this._ready=false;if(n(e,this._preIdOrSettings)){return this}this._preIdOrSettings=a(e,500);if(typeof e==="string"){try{e=JSON.parse(e)}catch(e){}}if(typeof e==="object"){if(e.manifestChanges){g.mapLanguagesInManifestChanges(e.manifestChanges);this._filterChildManifestChanges(e);this._filterManifestChangesByLayer(e)}if(this._oManifestModel){return}if(this._oDesigntimeInstance){this._oDesigntimeInstance.destroy()}if(e.host){this.setProperty("host",e.host)}if(e.baseUrl){this.setProperty("baseUrl",e.baseUrl)}this._aAppliedLayerChanges=e.manifestChanges;this.createManifest(e,t)}};Q.prototype.createManifest=function(e,t){var i=this.getBaseUrl();var a={},n=e.manifest;this._isManifestReady=false;if(typeof n==="string"){a.manifestUrl=n;n=null}if(this._oManifest){this._oManifest.destroy()}this.destroyAggregation("_extension");var r=B.layers[this.getMode()];this._oManifest=new w(this.getSection(),n,i,e.manifestChanges);this._oManifest.load(a).then(async function(){this._registerManifestModulePath();this._oInitialManifestModel=new f(this._oManifest._oInitialJson);this.setProperty("json",this._oManifest._oInitialJson,t);var e=this._oManifest.oJson;var i=s({},e);this._oBeforeLayerManifestModel=new f(i);if(r<B.layers[N.EDITOR_MODE.TRANSLATION]&&this._oCurrentLayerChange){e=B.mergeDelta(e,[this._oCurrentLayerChange],this.getSection())}this._oManifestModel=new f(e);this._isManifestReady=true;this.fireManifestReady();this._initResourceBundlesForMultiTranslation();this._loadDefaultTranslations();if(this.getMode()===N.EDITOR_MODE.TRANSLATION){await this._loadSpecialTranslations()}this._createContextModel();if(this._oManifest.getResourceBundle()){this._enhanceI18nModel(this._oManifest.getResourceBundle())}return this._loadExtension().then(function(){this._initInternal()}.bind(this))}.bind(this))};Q.prototype._initResourceBundlesForMultiTranslation=function(){var e=this._oManifest.get("/sap.app/i18n");var t;var i;if(typeof e==="string"){t=this.getBaseUrl()+e}else if(typeof e==="object"){if(e.bundleUrl){t=this.getBaseUrl()+e.bundleUrl}if(e.supportedLocales){i=e.supportedLocales}}this._oEditorResourceBundles=new E({url:t,languages:Q._oLanguages,supportedLocales:i});this._oEditorResourceBundles.loadResourceBundles()};Q.prototype._registerManifestModulePath=function(){if(!this._oManifest){return}this._sAppId=this._oManifest.get("/sap.app/id");if(this._sAppId){M.registerResourcePath(this._sAppId.replace(/\./g,"/"),this._oManifest.getUrl()||"/")}else{I.error("sap.ui.integration.editor.Editor: sap.app/id entry in the manifest is mandatory")}};Q.prototype._loadDefaultTranslations=async function(){if(this._defaultTranslationsLoaded){return}var e=new L({bundle:this._oResourceBundle});await e.getResourceBundle();this.setModel(e,"i18n");this._defaultTranslationsLoaded=true};Q.prototype._enhanceI18nModel=async function(e){var t=this.getModel("i18n");if(t.getResourceBundle().oUrlInfo.url!==e.oUrlInfo.url){await t.enhance(e);this._oResourceBundle=await t.getResourceBundle()}};Q.prototype._loadExtension=function(){var e=this._oManifest.get(this.getConfigurationPath()+"/extension")||this._oManifest.get("/"+this.getSection()+"/extension"),t;if(!e){I.info("sap.ui.integration.editor.Editor: extension is not defined in manifest, do not load it.");return new Promise(function(e,t){e()})}if(e.startsWith(Y)){t=e.replace(Y,"")}else{t=this._sAppId.replace(/\./g,"/")+"/"+e}return new Promise(function(i,a){sap.ui.require([t],function(e){var t=new e;if(t._setEditor){t._setEditor(this,this._oLimitedInterface);this.setAggregation("_extension",t)}i()}.bind(this),function(t){I.error("sap.ui.integration.editor.Editor: failed to load "+e+". Check if the path is correct. Reason: "+t);a(t)})}.bind(this))};Q.prototype.request=function(e){var t=this._oDataProviderFactory.create({request:e}).setAllowCustomDataType(true);return t._waitDependencies().then(function(){return t.getData()})};Q.prototype.initDestinations=function(e){this._oDestinationsModel=new f({});this.setModel(this._oDestinationsModel,"destinations");var t=this.getHostInstance();if(e&&!t){I.error("sap.ui.integration.editor.Editor: Host with id '"+e+"' is not available during editor initialization. It must be available for host specific features to work.","Make sure that the host already exists, before assigning it to the editor.","sap.ui.integration.editor.Editor")}if(this._oDestinations){this._oDestinations.setHost(t)}else{var i=this.getConfigurationPath();this._oDestinations=new h({host:t,manifestConfig:this._oManifestModel.getProperty(i+"/destinations"),prefix:"destinations"})}};Q.prototype.initDataProviderFactory=function(){if(this._oDataProviderFactory){this._oDataProviderFactory.destroy()}var e=this.getAggregation("_extension");this._oDataProviderFactory=new p({destinations:this._oDestinations,extension:e,csrfTokensConfig:this._oManifest.get(this.getConfigurationPath()+"/csrfTokens"),editor:this})};Q.prototype.getRuntimeUrl=function(e){var t=this._sAppId,i,a=e&&e.trim().replace(/^\//,"");if(t===null){I.error("sap.ui.integration.editor.Editor: manifest is not ready so the URL can not be resolved. Consider using the 'manifestReady' event.","sap.ui.integration.editor.Editor");return null}if(!t||e.startsWith("http://")||e.startsWith("https://")||e.startsWith("//")){return e}i=t.replace(/\./g,"/");return sap.ui.require.toUrl(i)+"/"+a};Q.prototype.getBindingNamespaces=function(){var e={},t=this.getAggregation("_extension");if(t){e.extension={formatters:t.getFormatters()}}return e};Q.prototype.getHostInstance=function(){var e=this.getHost();if(!e){return null}return o.getElementById(e)};Q.prototype.setLanguage=function(e,t){if(!e||typeof e!=="string"){return this}this._language=e.replaceAll("_","-");if(this.getLanguage()!=e){this._loadDefaultTranslations()}this.setProperty("language",e,t);if(!Q._oLanguages[this._language]){this._language=this._language.split("-")[0]}if(!Q._oLanguages[this._language]){I.warning("sap.ui.integration.editor.Editor: language: "+e+" is currently unknown, some UI controls might show "+e+" instead of the language name.")}return this};Q.prototype.onAfterRendering=function(){if(this.getDomRef()){this._iZIndex=G(this.getDomRef());T.setInitialZIndex(this._iZIndex)}};Q.prototype._filterChildManifestChanges=function(e){var t=this;if(t._bChildManifestChangesFiltered){return}t._aMainEditorChanges=a(e.manifestChanges,500);t._oChildEditorChanges={};var i=function(e,a){a=a?a+"/":"";Object.keys(e).forEach(function(n){if(n.startsWith(t.getConfigurationPath()+"/childCards/")&&n.endsWith("_manifestChanges")){var s=n.substring("/sap.card/configuration/childCards/".length);var r=s.split("/")[0];if(r){var o=a+r;t._oChildEditorChanges[o]=t._oChildEditorChanges[o]||[];t._oChildEditorChanges[o].push(e[n]);if(e[n]!==null){i(e[n],o)}}}})};t._aMainEditorChanges.forEach(function(e){i(e)});Object.keys(t._oChildEditorChanges).forEach(function(e){t._oChildEditorChanges[e].forEach(function(e){Object.keys(e).forEach(function(i){if(i.startsWith(t.getConfigurationPath()+"/childCards/")&&i.endsWith("_manifestChanges")){delete e[i]}})})});t._aMainEditorChanges.forEach(function(e){Object.keys(e).forEach(function(i){if(i.startsWith(t.getConfigurationPath()+"/childCards/")&&i.endsWith("_manifestChanges")){delete e[i]}})});t._bChildManifestChangesFiltered=true};Q.prototype._filterManifestChangesByLayer=function(t){var i=[],a=this,n={},r={":layer":B.layers[this.getMode()]},o=B.layers[a.getMode()];t.manifestChanges.forEach(function(t){var l=t.hasOwnProperty(":layer")?t[":layer"]:1e3;if(l===B.layers[N.EDITOR_MODE.TRANSLATION]){var d=a._language;if(d===""){d=e.getLanguage().replaceAll("_","-")}var f={texts:{}};delete t.texts;f.texts[d]={};Object.keys(t).forEach(function(e){if(e.charAt(0)==="/"){f.texts[d][e]=t[e]}else{f[e]=t[e]}});t=f}if(l<o){i.push(t);n=s(n,t)}else if(l===o){r=t}});t.manifestChanges=i;this._oCurrentLayerChange=r;this._oBeforeLayerChange=n};Q.prototype.createChildTree=function(e){var t=this;var i=this.getBaseUrl();var a=t._vIdOrSettings.manifest;if(typeof t._vIdOrSettings.manifest==="object"){a=JSON.stringify(t._vIdOrSettings.manifest)}var n=this._oManifest.get("/sap.app/title")||this._oResourceBundle.getText("EDITOR_CHILD_TREE_MAIN_NODE_TEXT");var s=[{text:n,baseUrl:i,manifest:a,path:"",selected:true,nodes:[]}];var r=new f(s);var o=function(e,i,a,n,s){var l=n+i.manifest;n=l.substring(0,l.lastIndexOf("/")+1);var d={text:e,baseUrl:n,manifest:l,isChild:true,path:a,selected:false,nodes:[]};if(i.manifest){try{var f=t._sAppId.replace(/\./g,"/");if(s){f+="/"+s}f+="/"+i.manifest;M.loadResource(f,{dataType:"json",async:true,failOnError:false}).then(function(t){if(t&&t["sap.card"]?.configuration?.childCards){var s=t["sap.card"].configuration.childCards;for(var l in s){var f=o(l,s[l],a?a+"/"+l:l,n,e);d.nodes.push(f)}}if(t){d.text=i.title||t["sap.app"].title||d.text}else if(i.title){d.text=i.title}r.checkUpdate(true)})}catch(e){if(i.title){d.text=i.title}r.checkUpdate(true);I.error("sap.ui.integration.editor.Editor: child edtior tree manifest load error: "+e)}}else if(i.title){d.text=i.title}return d};for(var l in e){var d=o(l,e[l],l,i);s[0].nodes.push(d)}t._oChildTree=new W({items:{path:"/",template:new H({title:"{text}",tooltip:"{text}",type:"Active",highlight:"{= ${selected} ? 'Information' : 'None'}"})},toggleOpenState:t.onToggleOpenState,itemPress:t.onTreeItemPress.bind(t)}).addStyleClass("sapUiIntegrationEditorChildTreeItem");t._oChildTree.setModel(r)};Q.prototype.onToggleOpenState=function(e){var t=e.getSource();var i=e.getParameter("expanded");if(i){I.info("sap.ui.integration.editor.Editor: child edtior tree item expanded: "+e.getParameter("itemIndex"));t.expand([e.getParameter("itemIndex")])}else{I.info("sap.ui.integration.editor.Editor: child edtior tree item collapsed: "+e.getParameter("itemIndex"));t.collapse([e.getParameter("itemIndex")])}};Q.prototype.onTreeItemPress=function(e){var t=e.getParameter("srcControl");if(!t||!t.getBindingContext()||!t.getBindingContext().getObject()){I.error("sap.ui.integration.editor.Editor: child editor tree item pressed without binding context or binding object");return}var i=t.getBindingContext().getObject();var a=i.manifest;if(!a){I.error("sap.ui.integration.editor.Editor: child editor tree item pressed without manifest");return}try{a=JSON.parse(a)}catch(e){I.info("sap.ui.integration.editor.Editor: child editor tree item pressed with manifest not json")}var n=i.path||"/";this._oChildTree._path=this._oChildTree._path||"/";if(this._oChildTree._path===n){I.info("sap.ui.integration.editor.Editor: same item pressed, do nothing");return}var r=this.getCurrentSettings(true);this._oChildEditorChanges=this._oChildEditorChanges||{};this._aMainEditorChanges=this._aMainEditorChanges||[];var o=r[":layer"];var l,d;if(!this.isChild){l=this._aMainEditorChanges.find(function(e){return e[":layer"]===o});if(l){d=s({},l,r);var f=this._aMainEditorChanges.indexOf(l);if(f>-1){this._aMainEditorChanges.splice(f,1)}l=d}else{l=r}this._aMainEditorChanges.push(l)}else{this._oChildEditorChanges[this._oChildTree._path]=this._oChildEditorChanges[this._oChildTree._path]||[];var u=this._oChildEditorChanges[this._oChildTree._path];l=u.find(function(e){return e[":layer"]===o});if(l){d=s({},l,r);var f=u.indexOf(l);if(f>-1){u.splice(f,1)}l=d}else{l=r}u.push(l)}this.cleanAndReset();this.switchToEditor(a,i,n);var g=this._oChildTree.getModel();var h=this._oChildTree._itemIndex||"/0";g.setProperty(h+"/selected",false);i.selected=true;g.checkUpdate(true);this._oChildTree._itemIndex=t.getBindingContext().getPath();this._oChildTree._path=n;I.info("sap.ui.integration.editor.Editor: child editor tree item pressed")};Q.prototype.switchToEditor=function(e,t,i){this._oChildTreeSettings=this._oChildTreeSettings||{};if(!this._oChildTreeSettings[this._oChildTree._path]){this._oChildTreeSettings[this._oChildTree._path]=a(this._vIdOrSettings,500)}this.isChild=t.isChild;var n;if(!this.isChild){n=this._aMainEditorChanges}else{n=this._oChildEditorChanges[i]||[]}if(this._oChildTreeSettings[i]){this._vIdOrSettings=this._oChildTreeSettings[i]}else{this._vIdOrSettings.baseUrl=t.baseUrl;this._vIdOrSettings.manifest=e}this._vIdOrSettings.manifestChanges=n;this.setJson(this._vIdOrSettings,true)};Q.prototype._initInternal=function(){var e=this;var t=e.getConfigurationPath();var i=e._oManifest.get(t+"/editor");if(!i){i=e._oManifest.get("/"+e.getSection()+"/designtime")}if(!e._oChildTree){var a=e._oManifest.get(t+"/childCards");if(a&&typeof a==="object"){e.createChildTree(a)}}var n=e._oManifestModel.getProperty(t),s,r=e.getDesigntime();if(r){if(typeof r==="function"){s=new Promise(function(t,i){var a=new r;e._applyDesigntimeDefaults(a.getSettings());t(a)})}else if(typeof r==="object"){s=new Promise(function(t,i){sap.ui.require(["sap/ui/integration/Designtime"],function(i){var a=i.extend("test.Designtime");a.prototype.create=function(){return r};var n=new a;e._applyDesigntimeDefaults(n.getSettings());t(n)})})}}else if(i){s=e.loadDesigntime().then(function(t){e._applyDesigntimeDefaults(t.getSettings());return t})}else{s=Promise.resolve(e._createParameterDesigntime(n))}s.then(function(t){e._oDesigntimeInstance=t;e.initDestinations();e.initDataProviderFactory();if(!e.isChild&&(e.getMode()===N.EDITOR_MODE.ADMIN||e.getMode()===N.EDITOR_MODE.ALL)){e._addDestinationSettings(n)}else{e._deleleDestinationSettings()}e._oSettingsModel=new f(e._oDesigntimeInstance.getSettings());e.setModel(e._oSettingsModel,"currentSettings");e.setModel(e._oSettingsModel,"items");return e._loadValueContextInDesigntime()}).then(function(){e._applyDesigntimeLayers();return e._requestExtensionData()}).then(function(){e._requireFields().then(function(){e._startEditor()})})};Q.prototype.loadDesigntime=function(){if(this._oDesigntime){return Promise.resolve(this._oDesigntime)}if(!this._oManifest){return new Promise(function(e,t){this.attachManifestReady(function(){this.loadDesigntime().then(e,t)}.bind(this))}.bind(this))}if(!this._sAppId){return Promise.reject("App id not maintained")}return new Promise(function(e,t){var i=this._oManifest.get(this.getConfigurationPath()+"/editor");if(!i){i=this._oManifest.get("/"+this.getSection()+"/designtime")}var a=this._sAppId.replace(/\./g,"/")+"/"+i;if(a){sap.ui.require([a],function(t){t=new t;t._readyPromise(this._oLimitedInterface,this).then(function(){this._oDesigntime=t;e(t)}.bind(this))}.bind(this),function(){t({error:a+" not found"})})}else{t()}}.bind(this))};Q.prototype.getConfigurationPath=function(){return"/"+this.getSection()+"/configuration"};Q.prototype.getCurrentSettings=function(e){e=e||false;var t=this._oSettingsModel.getProperty("/"),i={},r;if(t&&t.form&&t.form.items){for(var o in t.form.items){var l=t.form.items[o];if(l.editable&&l.visible){if(this.getMode()!==N.EDITOR_MODE.TRANSLATION){if(l.translatable&&!l._changed&&l._translatedPlaceholder&&!this._oCurrentLayerChange[l.manifestpath]){}else{if(l.valueItems&&!n(this._oBeforeLayerChange[l.manifestpath.substring(0,l.manifestpath.lastIndexOf("/"))+"/valueItems"],l.valueItems)){i[l.manifestpath.substring(0,l.manifestpath.lastIndexOf("/"))+"/valueItems"]=l.valueItems}if(l.valueTokens&&!n(this._oBeforeLayerChange[l.manifestpath.substring(0,l.manifestpath.lastIndexOf("/"))+"/valueTokens"],l.valueTokens)){i[l.manifestpath.substring(0,l.manifestpath.lastIndexOf("/"))+"/valueTokens"]=l.valueTokens}var d=this._oBeforeLayerChange[l.manifestpath];if(typeof l.value!=="undefined"&&!n(d,l.value)){switch(l.type){case"string":if(!l.translatable){i[l.manifestpath]=l.value}else if(l._hasDynamicValue){i[l.manifestpath]=l.value;this.deleteAllTranslationValuesInTexts(l.manifestpath)}else if(l._beforeLayerValue&&(l._beforeLayerValue.indexOf("{context>")===0||l._beforeLayerValue.indexOf("{{parameters")===0)){i[l.manifestpath]=l.value}break;case"group":break;case"date":case"datetime":if(d){if(l.value){var f=new Date(d);var u=new Date(l.value);if(f.getTime()!==u.getTime()){i[l.manifestpath]=l.value}}}else if(l.value){i[l.manifestpath]=l.value}break;case"object":if(l.value&&l.value!==""&&typeof l.value==="object"){i[l.manifestpath]=l.value}break;case"object[]":if(Array.isArray(l.value)){var g=a(l.value,500);g=g.sort(function(e,t){if(!e._dt||!e._dt._position||!t._dt||!t._dt._position){return 0}return e._dt._position-t._dt._position});for(var h=0;h<g.length;h++){var p=g[h];p._dt=p._dt||{};p._dt._position=h+1}i[l.manifestpath]=g}break;default:if(l.manifestpath){i[l.manifestpath]=l.value}}}}}else if(l.translatable&&l.value){if(l._changed){i[l.manifestpath]=l.value}else if(this._oCurrentLayerChange&&this._oCurrentLayerChange.texts&&this._oCurrentLayerChange.texts[this._language]&&this._oCurrentLayerChange.texts[this._language][l.manifestpath]){i[l.manifestpath]=this._oCurrentLayerChange.texts[this._language][l.manifestpath]}}if(l._next&&this.getAllowSettings()){if(l.type==="destination"){if(l._next.pageAdminNewDestinationParameter){r=r||{};r[l._settingspath+"/pageAdminNewDestinationParameter"]=l._next.pageAdminNewDestinationParameter}}else{var c=typeof l.visibleToUser==="undefined"?true:l.visibleToUser;var _=typeof l.editableToUser==="undefined"?true:l.editableToUser;var m=typeof l.allowDynamicValues==="undefined"?true:l.allowDynamicValues;if(l._next.visible===!c){r=r||{};r[l._settingspath+"/visible"]=l._next.visible}if(l._next.editable===!_){r=r||{};r[l._settingspath+"/editable"]=l._next.editable}if(l._next.allowDynamicValues===!m){r=r||{};r[l._settingspath+"/allowDynamicValues"]=l._next.allowDynamicValues}if(l._next.pageAdminValues){r=r||{};r[l._settingspath+"/pageAdminValues"]=l._next.pageAdminValues}}}}}}if(this.getMode()===N.EDITOR_MODE.TRANSLATION){delete i.texts}else if(t.texts){i.texts=a(t.texts,500)||{};var v=s({},this._oBeforeLayerChange.texts);if(n(v,i.texts)){delete i.texts}else{for(var y in i.texts){if(n(v[y],i.texts[y])){delete i.texts[y]}else{for(var b in i.texts[y]){if(v[y]&&n(v[y][b],i.texts[y][b])){delete i.texts[y][b]}else if(typeof i.texts[y][b]==="object"){var C=i[b];if(!C||typeof C!=="object"||n(C,{})||n(C,[])){delete i.texts[y][b]}else if(Array.isArray(C)){var I=C.map(function(e){return e._dt?e._dt._uuid||"":""});for(var T in i.texts[y][b]){if(!I.includes(T)){delete i.texts[y][b][T]}}}else{var D=C._dt?C._dt._uuid||"":"";if(D!==""){var E=i.texts[y][b][D];if(!E){delete i.texts[y][b]}else{i.texts[y][b]={};i.texts[y][b][D]=E}}else{delete i.texts[y][b]}}}}if(n(i.texts[y],{})){delete i.texts[y]}}}if(n(i.texts,{})){delete i.texts}}}var S=B.layers[this.getMode()];i[":layer"]=S;i[":errors"]=this.checkCurrentSettings()[":errors"];if(r){i[":designtime"]=r}if(t[":designtime"]){i[":designtime"]=s(i[":designtime"],t[":designtime"])}if(this._oChildTree){this._childSettings=this._childSettings||[];this._mainSettings=this._mainSettings||{};if(this.isChild){this._childSettings[this._oChildTree._path]=i}else{this._mainSettings=i}if(!e){var M=a(this._mainSettings,500);Object.keys(this._childSettings).forEach(function(e){var t=this._childSettings[e];var i=e.split("/");var a=M;i.forEach(function(e,n){if(e&&t){var s=this.getConfigurationPath()+"/childCards/"+e+"/_manifestChanges";if(n===i.length-1){a[s]=t}else{a[s]=a[s]||{":layer":S,":errors":false};a=a[s]}}}.bind(this))}.bind(this));return M}}return i};Q.prototype.checkCurrentSettings=function(){var e=this._oSettingsModel.getProperty("/"),t={};if(e&&e.form&&e.form.items){for(var i in e.form.items){var a=e.form.items[i];if(a.editable){if(a.validateCheck==="failed"){t[a.manifestpath]=false}else if((a.isValid||a.required)&&!(this.getMode()===N.EDITOR_MODE.TRANSLATION&&a.translatable)){if(a.isValid){t[a.manifestpath]=a.isValid(a)}t[a.manifestpath]=true;var n=a.value;var s=a.type;if(s==="string"&&n===""){t[a.manifestpath]=n}if((s==="date"||s==="datetime")&&isNaN(Date.parse(n))){t[a.manifestpath]=n}if(s==="integer"){if(isNaN(parseInt(n))){t[a.manifestpath]=n}else if(n<a.min||n>a.max){t[a.manifestpath]=n}}if(s==="number"){if(isNaN(parseFloat(n))){t[a.manifestpath]=n}else if(n<a.min||n>a.max){t[a.manifestpath]=n}}}}}t[":layer"]=B.layers[this.getMode()]}t[":errors"]=Object.values(t).indexOf(false)>-1;return t};Q.prototype._createContextModel=function(){var e=this.getHostInstance(),t=new f({}),i=new f([]);this.setModel(t,"context");this.setModel(i,"contextflat");t._aPendingPromises=[];i._getPathObject=function(e){var t=this.getData().filter(function(t){if(t.path===e){return true}});return t.length?t[0]:null};i._getValueObject=function(e){var t=this.getData()||[];t=t.filter(function(t){if(t.value===e||t.object.value===e){return true}});return t.length?t[0]:null};var a=new Promise(function(t,i){if(e&&e.getContext){var a=false;setTimeout(function(){if(a){return}I.error("sap.ui.integration.editor.Editor: context could not be determined with "+z+".");a=true;t({})},z);e.getContext().then(function(e){if(a){I.error("sap.ui.integration.editor.Editor: context returned after more than "+z+". Context is ignored.")}a=true;t(e||{})})}else{t({})}});a.then(function(e){var a=this._mergeContextData(e);t.setData(a);i.setData(this.flattenData(a,"label"))}.bind(this));t.getProperty=function(t,i){if(t&&!t.startsWith("/")&&!i){t="/"+t}var a=this.resolve(t,i),n;if(a.endsWith("/value")){this._mValues=this._mValues||{};if(this._mValues.hasOwnProperty(a)){return this._mValues[a]}this._mValues[a]=undefined;n=g.timeoutPromise(e.getContextValue(a.substring(1)));n=n.then(function(e){this._mValues[a]=e;this.checkUpdate()}.bind(this)).catch(function(e){this._mValues[a]=null;this.checkUpdate();I.error("sap.ui.integration.editor.Editor: path "+a+" could not be resolved. Reason: "+e)}.bind(this));this._aPendingPromises.push(n);return undefined}else{return f.prototype.getProperty.apply(this,arguments)}}};Q.prototype._mergeContextData=function(e){var t={};t["empty"]=Z.empty;for(var i in e){t[i]=e[i]}t["editor.internal"]=Z["editor.internal"];return t};Q.prototype._loadValueContextInDesigntime=function(){var e=this.getModel("context");var t=this._oDesigntimeInstance.getSettings();var i;if(t&&t.form&&t.form.items){i=JSON.stringify(t.form.items)}if(i){var a=/\{context\>[\/?\w+.]+\}/g;var n=i.match(a);var s;if(n&&n.length>0){n=n.filter(function(e){return e.endsWith("value}")});s=n.map(function(e){return e.substring("{context>".length,e.length-1)});s.forEach(function(t){e.getProperty(t)});return Promise.all(e._aPendingPromises).then(function(){e._aPendingPromises=[]})}}return Promise.resolve()};Q.fieldMap={string:"sap/ui/integration/editor/fields/StringField","string[]":"sap/ui/integration/editor/fields/StringListField",integer:"sap/ui/integration/editor/fields/IntegerField",number:"sap/ui/integration/editor/fields/NumberField",boolean:"sap/ui/integration/editor/fields/BooleanField",date:"sap/ui/integration/editor/fields/DateField",datetime:"sap/ui/integration/editor/fields/DateTimeField",object:"sap/ui/integration/editor/fields/ObjectField","object[]":"sap/ui/integration/editor/fields/ObjectListField",destination:"sap/ui/integration/editor/fields/DestinationField",group:"sap/ui/integration/editor/fields/GroupField"};Q.Fields=null;Q.prototype._requireFields=function(){if(Q.Fields){return Promise.resolve()}return new Promise(function(e){sap.ui.require(Object.values(Q.fieldMap),function(){Q.Fields={};for(var t in Q.fieldMap){Q.Fields[t]=arguments[Object.keys(Q.fieldMap).indexOf(t)]}const i=[];for(const e of Object.values(Q.Fields)){if(e.loadDependencies){i.push(e.loadDependencies())}}Promise.all(i).then(e)})})};Q.prototype._createDescription=function(e,t){var i=new v(this.getId()+"_"+t+"_description_icon",{src:"sap-icon://message-information",color:"Marker",size:"12px",useIconTooltip:false,visible:typeof e.visible==="boolean"?"{currentSettings>visible}":e.visible,objectBindings:{currentSettings:{path:"currentSettings>"+e._settingspath},items:{path:"items>/form/items"},context:{path:"context>/"}}});i.addStyleClass("sapUiIntegrationEditorDescriptionIcon");i.onmouseover=function(t){t.addDependent(this._getPopover());this._getPopover().getContent()[0].applySettings({text:e.description});this._getPopover().openBy(t)}.bind(this,i);i.onmouseout=function(e){this._getPopover().close();e.removeDependent(this._getPopover())}.bind(this,i);return i};Q.prototype._createMessageIcon=function(e,t){var i=e.getConfiguration();var a=new v(this.getId()+"_"+t+"_message_icon",{src:"sap-icon://message-information",size:"12px",visible:typeof i.visible==="boolean"?"{currentSettings>visible}":i.visible,useIconTooltip:false,objectBindings:{currentSettings:{path:"currentSettings>"+i._settingspath},items:{path:"items>/form/items"},context:{path:"context>/"}}});a.onmouseover=function(e){e._showMessage()}.bind(this,e);a.onmouseout=function(e){e._hideMessage()}.bind(this,e);a.addStyleClass("sapUiIntegrationEditorMessageIcon");return a};Q.prototype._createLabel=function(e,t){var i=new c(this.getId()+"_"+t+"_label",{text:e.label,tooltip:e.tooltip||e.label,required:e.required&&e.editable||false,visible:typeof e.visible==="boolean"?"{currentSettings>visible}":e.visible,objectBindings:{currentSettings:{path:"currentSettings>"+e._settingspath},items:{path:"items>/form/items"},context:{path:"context>/"}}});i._cols=e.cols||2;if(e.layout){i._layout=e.layout}i._sOriginalType=e.type;return i};Q.prototype._createSettingsButton=function(e,t){var i=e.getConfiguration();var a=new j(this.getId()+"_"+t+"_settings_btn",{icon:"{= ${currentSettings>_hasDynamicValue} ? 'sap-icon://display-more' : 'sap-icon://enter-more'}",type:"Transparent",tooltip:this._oResourceBundle.getText("EDITOR_FIELD_MORE_SETTINGS"),press:function(t){this._openSettingsDialog(200,t.oSource,e)}.bind(this),visible:typeof i.visible==="boolean"?"{currentSettings>visible}":i.visible,objectBindings:{currentSettings:{path:"currentSettings>"+i._settingspath},items:{path:"items>/form/items"},context:{path:"context>/"}}});return a};Q.prototype._getSettingsPanel=function(e){if(!e._oSettingsPanel){e._oSettingsPanel=new F}return e._oSettingsPanel};Q.prototype._openSettingsDialog=function(e,t,i){var a=this._getSettingsPanel(i);window.setTimeout(function(){a.setConfiguration(i.getConfiguration());a.open(t,t,this,i.getHost(),i,i._applySettings.bind(i),i._cancelSettings.bind(i))}.bind(this),e||600)};Q.prototype._getPopover=function(){if(this._oPopover){return this._oPopover}var e=new C({text:""});e.addStyleClass("sapUiTinyMargin sapUiIntegrationEditorDescriptionText");this._oPopover=new y(this.getId()+"_popover",{showHeader:false,content:[e]});this._oPopover.addStyleClass("sapUiIntegrationEditorPopover");return this._oPopover};Q.prototype._createField=function(e,t){var i=new Q.Fields[e.type](this.getId()+"_"+t+"_field",{configuration:e,mode:this.getMode(),host:this.getHostInstance(),parameterKey:t,objectBindings:{currentSettings:{path:"currentSettings>"+e._settingspath},items:{path:"items>/form/items"},context:{path:"context>/"},destinations:{path:"destinations>/"}},visible:typeof e.visible==="boolean"?"{currentSettings>visible}":e.visible});i.setAssociation("_editor",this);this._aFieldReadyPromise.push(i._readyPromise.then(function(){if(e.type!=="group"){if(e.require||e.validation||e.validations&&e.validations.length>0||e.values&&e.values.data&&!e.values.data.json){var a=this._createMessageIcon(i,t);i.setAssociation("_messageIcon",a)}if(e.description&&this.getMode()!==N.EDITOR_MODE.TRANSLATION){i._descriptionIcon=this._createDescription(e,t)}if(e._changeDynamicValues){i._settingsButton=this._createSettingsButton(i,t);i._applyButtonStyles()}}}.bind(this)));if(e.type!=="group"){i._oValueBinding=this._oSettingsModel.bindProperty(e._settingspath+"/value");i._oValueBinding.attachChange(function(){if(!this._bIgnoreUpdates){e._changed=true;if(e._dependentFields&&e._dependentFields.length>0){this._updateEditor(e._dependentFields)}this._updatePreview()}}.bind(this));if(i.isFilterBackend()){var a=this._oSettingsModel.bindProperty(e._settingspath+"/suggestValue");a.attachChange(function(){var t=s({},e);t._cancel=false;this._addValueListModel(t,i)}.bind(this))}if(e.values){if(e.values.metadata){this._addMetadataModel(e,i)}if(e.type==="string[]"&&i.isFilterBackend()&&e.visualization&&e.visualization.type==="MultiInput"){i.setModel(new f({}),undefined)}else{var n=g.timeoutPromise(this._addValueListModel(e,i));n=n.catch(function(e){I.error("sap.ui.integration.editor.Editor: get data of field "+t+" could not be resolved. Reason: "+e)});this._aFieldDataReadyPromise.push(n)}}this._createDependentFields(e,i);i._oDataProviderFactory=this._oDataProviderFactory}i._cols=e.cols||2;if(e.layout){i._layout=e.layout}i._oEditorResourceBundles=this._oEditorResourceBundles;i.setAssociation("_messageStrip",X);return i};Q.prototype._updateEditor=function(e){if(this._fieldReady){if(e.length===0){return}for(var t=0;t<e.length;t++){var i=e[t];i.config._cancel=true}if(!this._oDataProviderFactory){return}this._bIgnoreUpdates=true;for(var t=0;t<e.length;t++){var i=e[t];i.config._cancel=false;this._addValueListModel(i.config,i.field,500*t)}this._bIgnoreUpdates=false}};Q.prototype._updatePreview=function(){var e=this.getAggregation("_preview")||this._oPreview;if(e&&e.update){e.update()}};Q.prototype._requestData=function(e,t){var i=this._oDataProviderFactory.create(e.values.data);i.bindObject({path:"items>/form/items"});i.bindObject({path:"currentSettings>"+e._settingspath});i.bindObject({path:"context>/"});return i._waitDependencies().then(function(){return i.getData()}).then(function(i){if(e._cancel){e._values=[];this._oSettingsModel.setProperty(e._settingspath+"/_loading",false);return}var a=e.values.data.path,n,s=[];if(a&&a!=="/"){if(a.startsWith("/")){a=a.substring(1)}if(a.endsWith("/")){a=a.substring(0,a.length-1)}n=a.split("/");s=P.get(n,i)}else{s=i}if(e.type==="object"||e.type==="object[]"){s.forEach(function(e){e._dt={_editable:false}})}if(this.getMode()===N.EDITOR_MODE.CONTENT&&e.pageAdminValues&&e.pageAdminValues.length>0){var r=e.pageAdminValues,o=e.value,l=e.valueItems||[],d=[],f=[],u=[];this.prepareFieldsInKey(e);if(r.length>0){for(var g=0;g<r.length;g++){for(var h=0;h<s.length;h++){var p=this.getKeyFromItem(s[h]);if(r[g]===p){d.push(s[h])}}if(Array.isArray(o)){for(var c=0;c<o.length;c++){if(r[g]===o[c]){f.push(o[c])}}for(var _=0;_<l.length;_++){var m=this.getKeyFromItem(l[_]);if(r[g]===m){u.push(l[_])}}}}if(f.length>0){e.value=[];e.value=f}if(u.length>0){e.valueItems=[];e.valueItems=u}}if(e.values.data.path&&e.values.data.path!=="/"){delete i[n];P.set(n,d,i)}else{i=[];i=d}}var v=t.getConfiguration();if(e.type==="string[]"){var y=e.values.data.path;if(y&&y!=="/"){if(y.startsWith("/")){y=y.substring(1)}if(y.endsWith("/")){y=y.substring(0,y.length-1)}var n=y.split("/");var b=P.get(n,i);if(Array.isArray(b)){for(var C in b){var I=t.getKeyFromItem(b[C]);if(Array.isArray(v.value)&&v.value.length>0&&v.value.includes(I)){b[C].Selected=this._oResourceBundle.getText("EDITOR_ITEM_SELECTED")}else{b[C].Selected=this._oResourceBundle.getText("EDITOR_ITEM_UNSELECTED")}}P.set(n,b,i)}}else if(Array.isArray(i)){for(var C in i){var I=t.getKeyFromItem(i[C]);if(Array.isArray(v.value)&&v.value.length>0&&v.value.includes(I)){i[C].Selected=this._oResourceBundle.getText("EDITOR_ITEM_SELECTED")}else{i[C].Selected=this._oResourceBundle.getText("EDITOR_ITEM_UNSELECTED")}}}}e._values=i;var T=t.getModel();T.setData(i);T.checkUpdate(true);T.firePropertyChange();if(e.type==="object"||e.type==="object[]"){t.mergeValueWithRequestResult(s)}this._oSettingsModel.setProperty(e._settingspath+"/_loading",false);t._hideValueState(true,true)}.bind(this)).catch(function(i){var a=new Promise(function(e){var t=this._oResourceBundle.getText("EDITOR_BAD_REQUEST");if(Array.isArray(i)&&i.length>0){t=i[0];var a=i[1];if(a){var n;a.text().then(function(i){if(g.isJson(i)){n=JSON.parse(i).error}else{t=i}if(n){t=(n.code||n.errorCode||a.status)+": "+n.message}e(t)});return}else{e(t);return}}else if(typeof i==="string"){t=i;e(t);return}else{e(t);return}}.bind(this));return a.then(function(i){var a=t.getModel();a.firePropertyChange();if(e.type==="object"||e.type==="object[]"){t.mergeValueWithRequestResult()}this._oSettingsModel.setProperty(e._settingspath+"/_loading",false);t._showValueState("error",i,true)}.bind(this))}.bind(this))};Q.prototype._requestExtensionData=function(){var e=this.getAggregation("_extension");if(!e){I.info("sap.ui.integration.editor.Editor: extension is not defined or created, do not load data of it.");return new Promise(function(e,t){e()})}var t=false;var i={};var a=this._oManifest.get(this.getConfigurationPath()+"/data/extension");var n;if(a){t=true;n=this._oManifest.get(this.getConfigurationPath()+"/data/path");i={extension:a};if(n){i.path=n}}else{a=this._oManifest.get("/"+this.getSection()+"/data/extension");if(a){t=true;n=this._oManifest.get("/"+this.getSection()+"/data/path");i={extension:a};if(n){i.path=n}}}if(!t){I.info("sap.ui.integration.editor.Editor: extension data is not defined in manifest, do not load data of it.");return new Promise(function(e,t){e()})}var s=this._oDataProviderFactory.create(i);return s._waitDependencies().then(function(){return s.getData()}).then(function(t){var i=e.getModel();if(!i){i=new f(t||{});e.setModel(i,undefined)}else{i.setData(t)}i.checkUpdate(true)}).catch(function(e){var t=this._oResourceBundle.getText("EDITOR_BAD_REQUEST");if(Array.isArray(e)&&e.length>0){t=e[0];var i=e[1];if(i){var a;i.text().then(function(e){if(g.isJson(e)){a=JSON.parse(e).error}else{t=e}if(a){t=(a.code||a.errorCode||i.status)+": "+a.message}I.error("sap.ui.integration.editor.Editor: request extension data failed, "+t)})}}else if(typeof e==="string"){t=e;I.error("sap.ui.integration.editor.Editor: request extension data failed, "+t)}}.bind(this))};Q.prototype._addValueListModel=function(e,t,i){if(e.values){var a;if(e.values.data){t.bindObject({path:e.values.data.path||"/"});if(this._oDataProviderFactory){a=t.getModel();if(!a){a=new f({});t.setModel(a,undefined)}this._oSettingsModel.setProperty(e._settingspath+"/_loading",true);if(!i){return this._requestData(e,t)}else{setTimeout(function(){return this._requestData(e,t)}.bind(this),i)}}}else if(this.getAggregation("_extension")){a=this.getAggregation("_extension").getModel();if(a&&this.getMode()===N.EDITOR_MODE.CONTENT&&e.pageAdminValues&&e.pageAdminValues.length>0){this.prepareFieldsInKey(e);var n=e.values.path;if(n.length>1){n=n.substring(1)}var s=P.get([n],a.getData()),r=e.pageAdminValues,o=[];for(var l=0;l<r.length;l++){for(var d=0;d<s.length;d++){var u=this.getKeyFromItem(s[d]);if(r[l]===u){o.push(s[d])}}}delete s[n];P.set(n,o,s);a.setData(s)}t.bindObject({path:e.values.path||"/"});t.setModel(a,undefined);return Promise.resolve(null)}}};Q.prototype._addMetadataModel=function(e,t){if(e.values&&e.values.metadata){var i=s({},e.values.metadata.request);var a={url:i.serviceUrl};var n=Promise.resolve(a);if(this._oDestinations){n=this._oDestinations.process(a)}n.then(function(e){if(!e.url.endsWith("/")){e.url=e.url+"/"}i.serviceUrl=e.url;var a=new u(i);a.oMetaModel.fetchData().then(function(e){t.setModel(new f(e),"meta")})})}};Q.prototype._createDependentFields=function(e,t){if(e.values){var i=JSON.stringify(e.values.data);if(i){var a=/parameters\.([^\}\}]+)|destinations\.([^\}\}]+)|\{items\>[\/?\w+]+\}/g,n=i.match(a);if(n){for(var r=0;r<n.length;r++){var o="/value";var l=this.getConfigurationPath();if(n[r].indexOf("destinations.")===0||n[r].indexOf("parameters.")===0){if(n[r].indexOf("destinations.")===0){o="/name"}l=l+"/"+n[r].replace(".","/")+o}else if(n[r].indexOf("{items>")===0){l=l+"/parameters/"+n[r].slice(7,-1)}var d=this._mItemsByPaths[l];if(d){if(d._settingspath===e._settingspath){e=s({},e)}d._dependentFields=d._dependentFields||[];d._dependentFields.push({field:t,config:e})}}}}}};Q.prototype.getTranslationValueInTexts=function(e,t){var i="/texts/"+e;var a=this._oSettingsModel.getProperty(i)||{};return a[t]};Q.prototype.deleteAllTranslationValuesInTexts=function(e){var t=this;var i=t._oSettingsModel.getData();if(!i||!i.texts){return}var n="/texts";var s=a(i.texts,500);for(var r in s){if(s[r][e]){delete s[r][e]}}this._oSettingsModel.setProperty(n,s)};Q.prototype._addItem=function(e,t){var i=this.getMode();if(this.getAllowDynamicValues()===false||!e.allowDynamicValues){e.allowDynamicValues=false}if(this.getAllowSettings()===false){e.allowSettings=false}e.__cols=e.cols||2;if(e.visible===false||!e.translatable&&i===N.EDITOR_MODE.TRANSLATION&&e.type!=="group"){return}if(e.type==="group"){e.expanded=e.expanded!==false;var n=this._createField(e,t);this.addAggregation("_formContent",n);if(e.hint){this._addHint(e.hint,this.getId()+"_"+t)}return}if(e.type==="separator"){var s=new R;this.addAggregation("_formContent",s);return}var r=null;var o=g._language;if(i===N.EDITOR_MODE.TRANSLATION){if(e.type!=="string"){return}if(typeof e.value==="string"&&e.value.indexOf("{")===0||typeof e.values!=="undefined"){return}e._language={value:e.value};e.cols=1;delete e.values;var l=a(e,500);l._settingspath+="/_language";l.editable=false;l.required=false;if(!Q._oLanguages[o]&&o.indexOf("-")>-1){o=o.substring(0,o.indexOf("-"))}if(Q._oLanguages[o]){var d=this.getTranslationValueInTexts(o,e.manifestpath);if(d){l.value=d}}if(!l.value){l.value="-"}var f=this._createLabel(l,t);this.addAggregation("_formContent",f);var u=this._createField(l,t+"_ori");u.isOrigLangField=true;this.addAggregation("_formContent",u);e.editable=e.visible=e.translatable;o=this._language;if(!this._oBeforeLayerChange[e.manifestpath]){e.value=e._translatedValue||""}var d=this.getTranslationValueInTexts(o,e.manifestpath);if(d){e.value=d}e.label=e._translatedLabel||"";e.required=false;var h=this._createField(e,t+"_trans");var p={onAfterRendering:function(e){var t=document.getElementById(h.getId());t.setAttribute("aria-label",f)}};h.addEventDelegate(p);this.addAggregation("_formContent",h)}else{r=this._createLabel(e,t);this.addAggregation("_formContent",r);var c=this._oBeforeLayerChange[e.manifestpath];if(c){e._beforeLayerChange=c}if(this._oCurrentLayerChange&&this._oCurrentLayerChange[e.manifestpath]){e.value=this._oCurrentLayerChange[e.manifestpath];e._beforeLayerChange=e.value}if(e.type==="string"){o=this._language;var d=this.getTranslationValueInTexts(o,e.manifestpath);if(d){e.value=d}}var n=this._createField(e,t);var _={onAfterRendering:function(e){var t=document.getElementById(n.getId());t.setAttribute("aria-label",r)}};n.addEventDelegate(_);this.addAggregation("_formContent",n)}if(e.hint&&(!e.cols||e.cols===2)){this._addHint(e.hint,this.getId()+"_"+t)}e.cols=e.__cols;delete e.__cols};Q.prototype._createHint=function(e,t){e=e.replace(/<a href/g,"<a target='blank' href");var i=new A(t+"_hint",{htmlText:e});return i};Q.prototype._addHint=function(e,t){var i=this._createHint(e,t);this.addAggregation("_formContent",i)};Q.prototype._getCurrentLanguageSpecificText=function(e){if(this._oTranslationBundle){var t=this._oTranslationBundle.getText(e,[],true);if(t===undefined){return""}return t}return""};Q.prototype._loadSpecialTranslations=async function(){if(this._oTranslationBundle){return}var e=this._language;if(!e){return}var t=this._oManifest.get("/sap.app/i18n"),i,a;if(!t){return}if(typeof t==="string"){i=this.getBaseUrl()+t}else if(typeof t==="object"){if(t.bundleUrl){i=this.getBaseUrl()+t.bundleUrl}if(t.supportedLocales&&Array.isArray(t.supportedLocales)){a=t.supportedLocales;for(var n=0;n<a.length;n++){a[n]=a[n].replaceAll("_","-")}}}if(i){var s=[e];if(e.indexOf("-")>-1){s.push(e.substring(0,e.indexOf("-")))}if(!s.includes("en")){s.push("en")}s=this._filterSupportedFallbackLanguages(s,a);var r=await D.create({url:i,async:true,locale:s[0],supportedLocales:s,fallbackLocale:"en"});var o=new L({bundle:r});this._oTranslationBundle=await o.getResourceBundle()}};Q.prototype._filterSupportedFallbackLanguages=function(e,t){if(Array.isArray(t)){var i=[];for(var a=0;a<e.length;a++){if(t.includes(e[a])){i.push(e[a])}}e=i}return e};Q.prototype._startEditor=function(){var e=this.getAggregation("_formContent");if(e&&e.length>0){this.destroyAggregation("_formContent")}var t=this._oSettingsModel.getData();var i;if(t.form&&t.form.items){i=t.form.items;var a=false,n=this._bDestinationGroupAtTop?1:0,r=Object.keys(i),o=r.length,l=0;for(var d=n;d<o;d++){var f=i[r[d]];if(f.type==="destination"){if(!this._bDestinationGroupAtTop){break}l=d;continue}else if(f.type==="group"&&f.level!=="1"){break}else if(f.visible){a=true;break}}if(a){var u={type:"group",translatable:true,expanded:true,label:this._oResourceBundle.getText("EDITOR_PARAMETERS_GENERALSETTINGS"),_settingspath:"/form/items/generalPanel"};if(this._bDestinationGroupAtTop){var h={};var p=0;r.forEach(function(e){h[e]=i[e];if(p===l){h["generalPanel"]=u}p++});i=h}else{i=s({generalPanel:u},i)}t.form.items=i;this._oSettingsModel.setData(t)}}var c=this._oSettingsModel.getProperty("/");this._mItemsByPaths={};if(c.form&&c.form.items){i=c.form.items;var _=this._language||this.getLanguage()||g._language;if(this.getMode()===N.EDITOR_MODE.TRANSLATION){this._addItem({type:"group",translatable:true,expandable:false,expanded:true,label:this._oResourceBundle.getText("EDITOR_ORIGINALLANG")+": "+Q._oLanguages[_]},"translationTopPanel")}for(var m in i){var f=i[m];if(f){f.label=f.label||m;var v;if(f.manifestpath){this._mItemsByPaths[f.manifestpath]=f;if(this.getMode()!==N.EDITOR_MODE.TRANSLATION){v=this._oCurrentLayerChange[f.manifestpath]}}f._changed=v!==undefined&&this.getMode()!==N.EDITOR_MODE.TRANSLATION;if(f.values){f.translatable=false}f._beforeLayerValue=this._getBeforeLayerValue(f.manifestpath);if(f.type==="string"){f._translatedDefaultPlaceholder=this._getInitialValue(f.manifestpath);var y=null,b=f._translatedDefaultPlaceholder;if(b){if(this._isValueWithParameterSyntax(b)){f.translatable=false}if(this._isValueWithHandlebarsTranslation(b)){y=b.substring(2,b.length-2)}else if(b.startsWith("{i18n>")){y=b.substring(6,b.length-1)}if(y){f.translatable=true}else if(f.translatable&&this.getMode()===N.EDITOR_MODE.TRANSLATION&&!this._oBeforeLayerChange[f.manifestpath]){f._translatedValue=f._translatedDefaultPlaceholder;f.value=f._translatedValue}}f._translatedPlaceholder=f._beforeLayerValue;b=f._translatedPlaceholder;if(b){if(this._isValueWithParameterSyntax(b)){f.translatable=false}if(this._isValueWithHandlebarsTranslation(b)){y=b.substring(2,b.length-2)}else if(b.startsWith("{i18n>")){y=b.substring(6,b.length-1)}}if(f.value&&(f.value.indexOf("{context>")===0||f.value.indexOf("{{parameters")===0)){this.deleteAllTranslationValuesInTexts(f.manifestpath);y=null}var C=this.getTranslationValueInTexts(_,f.manifestpath);if(y){f._translatedValue=this.getModel("i18n").getResourceBundle().getText(y);if(f._changed){f.value=v}else if(f.value===f._translatedDefaultPlaceholder){f.value=f._translatedValue}if(this.getMode()===N.EDITOR_MODE.TRANSLATION){var I=this._getCurrentLanguageSpecificText(y);if(I!==""){f._translatedValue=I}}else if(C){f.value=C}}else if(this.getMode()!==N.EDITOR_MODE.TRANSLATION&&f.translatable&&C){f.value=C}if(this.getMode()===N.EDITOR_MODE.TRANSLATION){if(this._isValueWithHandlebarsTranslation(f.label)){f._translatedLabel=this._getCurrentLanguageSpecificText(f.label.substring(2,f.label.length-2),true)}else if(f.label&&f.label.startsWith("{i18n>")){f._translatedLabel=this._getCurrentLanguageSpecificText(f.label.substring(6,f.label.length-1),true)}}}else if(f.type==="string[]"){var T=f.manifestpath.substring(0,f.manifestpath.lastIndexOf("/"))+"/valueItems";var D=this._oManifestModel.getProperty(T);if(D){f.valueItems=D}var E=f.manifestpath.substring(0,f.manifestpath.lastIndexOf("/"))+"/valueTokens";var S=this._oManifestModel.getProperty(E);if(S){f.valueTokens=S}}else if(typeof f.value==="object"&&f.type==="object"){if(typeof f.value._editable==="boolean"){f.value._dt={_editable:f.value._editable};delete f.value._editable}}else if(Array.isArray(f.value)&&f.value.length>0&&f.type==="object[]"){f.value.forEach(function(e){if(typeof e._editable==="boolean"){e._dt={_editable:e._editable};delete e._editable}})}if(f.label&&this._isValueWithHandlebarsTranslation(f.label)){var M=f.label.substring(2,f.label.length-2);if(M){f.label=this.getModel("i18n").getResourceBundle().getText(M)}}}}}for(var m in i){var f=i[m];this._addItem(f,m)}var x=this._oSettingsModel.getProperty("/form/height")!==undefined?this._oSettingsModel.getProperty("/form/height"):"350px",P=this._oSettingsModel.getProperty("/form/width")!==undefined?this._oSettingsModel.getProperty("/form/width"):"100%";if(this.getProperty("height")===""){this.setProperty("height",x);document.body.style.setProperty("--sapUiIntegrationEditorFormHeight",x);document.body.style.setProperty("--sapUiIntegrationEditorPreviewHeight",x)}if(this.getProperty("width")===""){this.setProperty("width",P);document.body.style.setProperty("--sapUiIntegrationEditorFormWidth",P)}if(this.getMode()!==N.EDITOR_MODE.TRANSLATION&&this.getPreviewPosition()!=="separate"){this._initPreview()}Promise.all(this._aFieldReadyPromise).then(function(){this._fieldReady=true;this.fireFieldReady();if(this.getMode()!==N.EDITOR_MODE.ADMIN&&this.getMode()!==N.EDITOR_MODE.ALL){setTimeout(function(){this.fireDestinationReady()}.bind(this),100)}}.bind(this))};Q.prototype.setHeight=function(e){if(e){this.setProperty("height",e);document.body.style.setProperty("--sapUiIntegrationEditorFormHeight",e);document.body.style.setProperty("--sapUiIntegrationEditorPreviewHeight",e)}};Q.prototype.setWidth=function(e){if(e){this.setProperty("width",e);document.body.style.setProperty("--sapUiIntegrationEditorFormWidth",e)}};Q.prototype.destroy=function(){this.cleanAndReset();if(this._oPopover){this._oPopover.destroy()}var e=o.getElementById(X);if(e){e.destroy()}this._oDestinationsModel=null;this._oEditorResourceBundles=null;document.body.style.removeProperty("--sapUiIntegrationEditorFormWidth");document.body.style.removeProperty("--sapUiIntegrationEditorFormHeight");t.prototype.destroy.apply(this,arguments)};Q.prototype.cleanAndReset=function(){if(this._oDesigntimeInstance){this._oDesigntimeInstance.destroy()}this._oInitialManifestModel=null;this._oBeforeLayerManifestModel=null;this._oManifestModel=null;this._oSettingsModel=null;this._oDesigntime=null;this._aAppliedLayerChanges=[];this._oBeforeLayerChange={};this._oCurrentLayerChange={};this.resetProperty("designtime");this.destroyAggregation("_formContent");this._destoryPreview();this._ready=false;this._fieldReady=false};Q.prototype._initPreview=function(){};Q.prototype._destoryPreview=function(){var e=this.getAggregation("_preview");if(e){e.destroy();this.setAggregation("_preview",null)}};Q.prototype._applyDesigntimeDefaults=function(e){e=e||{};e.form=e.form||{};e.form.items=e.form.items||{};var t=e.form.items||e.form.items;for(var i in t){var a=t[i];if(a.type==="destination"){continue}if(a.manifestpath){a.value=this._oManifestModel.getProperty(a.manifestpath)}if(a.visible===undefined||a.visible===null){a.visible=true}if(a.editable===undefined||a.editable===null){a.editable=true}if(this.getMode()!==N.EDITOR_MODE.ADMIN){if(a.visibleToUser!==undefined){a.visible=a.visibleToUser}if(a.editableToUser!==undefined){a.editable=a.editableToUser}}if(typeof a.translatable!=="boolean"){a.translatable=false}if(!a.label){a.label=i}if(!a.type||a.type==="enum"){a.type="string"}if(a.value===undefined||a.value===null){switch(a.type){case"boolean":a.value=false;break;case"integer":case"number":a.value=0;break;case"string[]":a.value=[];break;case"object":a.value=undefined;break;case"object[]":a.value=undefined;break;default:a.value=""}}if(a.type==="group"){if(a.visible===undefined||a.value===null){a.visible=true}}a._settingspath="/form/items/"+i}};Q.prototype._applyDesigntimeLayers=function(e){var t={};var i={};if(this._aAppliedLayerChanges&&Array.isArray(this._aAppliedLayerChanges)){for(var a=0;a<this._aAppliedLayerChanges.length;a++){var r=this._aAppliedLayerChanges[a][":designtime"];if(r){var o=Object.keys(r);for(var l=0;l<o.length;l++){var d=o[l],f=r[d];if(!d.endsWith("/pageAdminValues")&&typeof f==="object"){if(f.configuration&&f.configuration.parameterFromDestination){var u=f.configuration;delete u.parameterFromDestination;u.value=this._oManifestModel.getProperty(u.manifestpath);u._settingspath="/form/items/"+f.parameter;this._oSettingsModel.setProperty(u._settingspath,u)}else{i[o[l]]=s(i[o[l]],f);continue}}else{this._oSettingsModel.setProperty(o[l],f)}}}var g=this._aAppliedLayerChanges[a]["texts"];if(g){t=s(t,g)}}}if(this._oCurrentLayerChange){var r=this._oCurrentLayerChange[":designtime"];if(r){var o=Object.keys(r);for(var l=0;l<o.length;l++){var d=o[l],f=r[d];h=d.substring(0,d.lastIndexOf("/")+1)+"_next";if(!d.endsWith("/pageAdminValues")&&typeof f==="object"){if(!f.configuration||!f.configuration.parameterFromDestination){i[d]=s(i[d],f);continue}}if(!this._oSettingsModel.getProperty(h)){this._oSettingsModel.setProperty(h,{})}var h=d.substring(0,d.lastIndexOf("/")+1)+"_next",p=d.substring(d.lastIndexOf("/")+1);this._oSettingsModel.setProperty(h+"/"+p,f)}}var c=this._oCurrentLayerChange["texts"];if(c){t=s(t,c)}}if(!n(t,{})){this._oSettingsModel.setProperty("/texts",t)}if(!n(i,{})){this._oSettingsModel.setProperty("/:designtime",i)}};Q.prototype._createParameterDesigntime=function(e){var t={},i=this.getConfigurationPath()+"/parameters",a=this.getMode();if(e&&e.parameters){t.form=t.form||{};t.form.items=t.form.items||{};var n=t.form.items;Object.keys(e.parameters).forEach(function(t){n[t]=s({manifestpath:i+"/"+t+"/value",editable:a!==N.EDITOR_MODE.TRANSLATION,_settingspath:"/form/items/"+t},e.parameters[t]);var r=n[t];if(!r.type){r.type="string"}if(!r.hasOwnProperty("visible")){r.visible=true}})}return new d(t)};Q.prototype._addDestinationSettings=function(e){var t=this._oDesigntimeInstance.getSettings(),i=this.getConfigurationPath()+"/destinations";t.form=t.form||{};t.form.items=t.form.items||{};if(t&&e&&e.destinations){this._bDestinationGroupAtTop=false;var a=t.form.items,n={},r=this.getHostInstance();var o={label:this._oResourceBundle.getText("EDITOR_DESTINATIONS")||"Destinations",type:"group",expanded:true,visible:true,_settingspath:"/form/items/destination.group"};if(a["destination.group"]){this._bDestinationGroupAtTop=Object.keys(a)[0]==="destination.group";o=s(o,a["destination.group"]);delete a["destination.group"]}n["destination.group"]=o;Object.keys(e.destinations).forEach(function(t){var r=s({manifestpath:i+"/"+t+"/name",visible:true,type:"destination",editable:true,allowDynamicValues:false,allowSettings:false,value:e.destinations[t].name,defaultValue:e.destinations[t].defaultUrl,_settingspath:"/form/items/"+[t+".destination"],_values:[],_destinationName:t},e.destinations[t]);if(typeof r.label==="undefined"){r.label=t}if(a[t+".destination"]){r=s(r,a[t+".destination"]);delete a[t+".destination"]}n[t+".destination"]=r});if(this._bDestinationGroupAtTop){t.form.items=s(n,a)}else{t.form.items=s(a,n)}var l=false;if(r){this._oDestinationsModel.setProperty("/_loading",true);this._oDestinationsModel.checkUpdate(true);this.getHostInstance().getDestinations().then(function(e){l=true;this._oDestinationsModel.setProperty("/_values",e);this._oDestinationsModel.setProperty("/_loading",false);this._oDestinationsModel.setSizeLimit(e.length);this._oDestinationsModel.checkUpdate(true);setTimeout(function(){this.fireDestinationReady()}.bind(this),100)}.bind(this)).catch(function(){return this.getHostInstance().getDestinations()}.bind(this)).then(function(e){if(l){return}this._oDestinationsModel.setProperty("/_values",e);this._oDestinationsModel.setProperty("/_loading",false);this._oDestinationsModel.setSizeLimit(e.length);this._oDestinationsModel.checkUpdate(true);setTimeout(function(){this.fireDestinationReady()}.bind(this),100)}.bind(this)).catch(function(e){this._oDestinationsModel.setProperty("/_loading",false);this._oDestinationsModel.checkUpdate(true);setTimeout(function(){this.fireDestinationReady()}.bind(this),100);I.error("sap.ui.integration.editor.Editor: can not get destinations list from '"+r.getId()+"'.")}.bind(this))}}};Q.prototype._deleleDestinationSettings=function(){var e=this._oDesigntimeInstance.getSettings();e.form=e.form||{};e.form.items=e.form.items||{};delete e.form.items["destination.group"];for(var t in e.form.items){var i=e.form.items[t];if(i.type==="destination"){delete e.form.items[t]}}};Q.prototype._getInitialValue=function(e){return this._oInitialManifestModel.getProperty(e)};Q.prototype._getBeforeLayerValue=function(e){return this._oBeforeLayerManifestModel.getProperty(e)};Q.prototype._isValueWithHandlebarsTranslation=function(e){if(typeof e==="string"){return!!e.match(K)}return false};Q.prototype._isValueWithParameterSyntax=function(e){if(typeof e==="string"){return!!e.match(J)}return false};Q.prototype.prepareFieldsInKey=function(e){this._sKeySeparator=e.values.keySeparator;if(!this._sKeySeparator){this._sKeySeparator="#"}var t=e.values.item.key;this._aFields=t.split(this._sKeySeparator);for(var i in this._aFields){if(this._aFields[i].startsWith("{")){this._aFields[i]=this._aFields[i].substring(1)}if(this._aFields[i].endsWith("}")){this._aFields[i]=this._aFields[i].substring(0,this._aFields[i].length-1)}}};Q.prototype.getKeyFromItem=function(e){var t="";this._aFields.forEach(function(i){t+=e[i].toString()+this._sKeySeparator}.bind(this));if(t.endsWith(this._sKeySeparator)){t=t.substring(0,t.length-this._sKeySeparator.length)}return t};Q.oResourceBundle=l.getResourceBundleFor("sap.ui.integration",g._language);Q.initContextEntries=function(){return{empty:{label:Q.oResourceBundle.getText("EDITOR_CONTEXT_EMPTY_VAL"),type:"string",description:Q.oResourceBundle.getText("EDITOR_CONTEXT_EMPTY_DESC"),placeholder:"",value:""},"editor.internal":{label:Q.oResourceBundle.getText("EDITOR_CONTEXT_EDITOR_INTERNAL_VAL"),todayIso:{type:"string",label:Q.oResourceBundle.getText("EDITOR_CONTEXT_EDITOR_TODAY_VAL"),description:Q.oResourceBundle.getText("EDITOR_CONTEXT_EDITOR_TODAY_DESC"),tags:[],placeholder:Q.oResourceBundle.getText("EDITOR_CONTEXT_EDITOR_TODAY_VAL"),customize:["format.dataTime"],value:"{{parameters.TODAY_ISO}}"},nowIso:{type:"string",label:Q.oResourceBundle.getText("EDITOR_CONTEXT_EDITOR_NOW_VAL"),description:Q.oResourceBundle.getText("EDITOR_CONTEXT_EDITOR_NOW_DESC"),tags:[],placeholder:Q.oResourceBundle.getText("EDITOR_CONTEXT_EDITOR_NOW_VAL"),customize:["dateFormatters"],value:"{{parameters.NOW_ISO}}"},currentLanguage:{type:"string",label:Q.oResourceBundle.getText("EDITOR_CONTEXT_EDITOR_LANG_VAL"),description:Q.oResourceBundle.getText("EDITOR_CONTEXT_EDITOR_LANG_VAL"),tags:["technical"],customize:["languageFormatters"],placeholder:Q.oResourceBundle.getText("EDITOR_CONTEXT_EDITOR_LANG_VAL"),value:"{{parameters.LOCALE}}"}}}};Z=Q.initContextEntries();Q.prototype._applyLanguageChange=function(){Z=Q.initContextEntries()};Q._oLanguages={};Q._appendThemeVars=function(){var e=["sapUiButtonHoverBackground","sapUiBaseBG","sapUiContentLabelColor","sapUiTileSeparatorColor","sapUiHighlight","sapUiListSelectionBackgroundColor","sapUiNegativeText","sapUiCriticalText","sapUiPositiveText","sapUiChartScrollbarBorderColor"];var t=x.get({name:e,callback:function(e){}});if(t){for(var i in t){document.body.style.setProperty("--"+i,t[i])}}};Q.init=function(){this.init=function(){};Q._appendThemeVars();var e=sap.ui.require.toUrl("sap.ui.integration.editor.css.Editor".replace(/\./g,"/")+".css");S(e);Q._oLanguages=M.loadResource("sap/ui/integration/editor/languages.json",{dataType:"json",failOnError:false,async:false})};Q.prototype.onThemeChanged=function(){Q._appendThemeVars()};Q.init();return Q});
//# sourceMappingURL=Editor.js.map