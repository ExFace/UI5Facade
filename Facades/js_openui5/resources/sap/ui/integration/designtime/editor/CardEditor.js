/*!
 * OpenUI5
 * (c) Copyright 2026 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Element","sap/ui/core/Lib","sap/ui/integration/editor/Editor","sap/ui/integration/editor/Constants","sap/ui/integration/widgets/Card","sap/ui/integration/editor/Merger","sap/ui/model/json/JSONModel","sap/base/util/merge","sap/ui/model/resource/ResourceModel","sap/ui/integration/library","sap/ui/integration/designtime/editor/CardPreview","sap/base/util/extend","sap/ui/integration/util/Utils","sap/base/Log","sap/base/util/deepClone"],function(e,t,i,r,s,o,n,a,d,h,g,l,_,u,p){"use strict";var C=h.CardDataMode,c;var f=i.extend("sap.ui.integration.designtime.editor.CardEditor",{metadata:{library:"sap.ui.integration",properties:{card:{type:"any",defaultValue:null}},aggregations:{_extension:{type:"sap.ui.integration.Extension",multiple:false,visibility:"hidden"}}},renderer:i.getMetadata().getRenderer().render});f.prototype.hasPreview=function(){var e=this.getAggregation("_preview");if(e){if(e.getSettings()&&e.getSettings().preview&&e.getSettings().preview.modes==="None"){return false}return true}return false};f.prototype.getSeparatePreview=function(){var e=this.getPreviewPosition();if(!this.isFieldReady()||e!=="separate"){return null}return this._initPreview()};f.prototype._updatePreview=function(){var e=this.getAggregation("_preview");if(e&&e.update&&e._getCurrentMode()!=="None"){e.update()}};f.prototype.switchToEditor=function(e,t,i){this._oChildTreeSettings=this._oChildTreeSettings||{};if(!this._oChildTreeSettings[this._oChildTree._path]){this._oChildTreeSettings[this._oChildTree._path]=this._oEditorCard}this.isChild=t.isChild;var r;if(!this.isChild){r=this._aMainEditorChanges}else{r=this._oChildEditorChanges[i]||[]}if(this._oChildTreeSettings[i]){this._vIdOrSettings=this._oChildTreeSettings[i];this._vIdOrSettings.setManifestChanges(r)}else{this._vIdOrSettings.baseUrl=t.baseUrl;this._vIdOrSettings.manifest=e;this._vIdOrSettings.manifestChanges=r}this.setCard(this._vIdOrSettings,true)};f.prototype.setCard=function(t,i){if(t===this.getProperty("card")){return this}if(this._oEditorCard){this._oEditorCard.destroy()}this.setProperty("card",t,i);if(typeof t==="string"){try{t=JSON.parse(t)}catch(i){var r=e.getElementById(t);if(!r){var o=document.getElementById(t);if(o&&o.tagName&&o.tagName.toUpperCase()==="ui-integration-card".toUpperCase()){r=o._getControl()}}t=r}}if(t&&t.isA&&t.isA("sap.ui.integration.widgets.Card")){t={manifest:t.getManifest(),manifestChanges:t.getManifestChanges(),host:t.getHost(),baseUrl:t.getBaseUrl(),dataMode:C.Active}}if(typeof t==="object"){if(!t.dataMode){t.dataMode=C.Active}this._oEditorCard=new s(t);this._oEditorCard.attachEventOnce("_contentReady",function(){var e=this._oEditorCard.getCardContent();if(e){e.onBeforeRendering()}}.bind(this));this._oEditorCard.attachEventOnce("_dataReady",function(){this.propagateModels(this._oEditorCard,this,["i18n","context","contextflat"]);this.setJson(t,i)}.bind(this));this._oEditorCard.onBeforeRendering()}};f.prototype.initDestinations=function(e){this._oDestinationsModel=new n({});this.setModel(this._oDestinationsModel,"destinations");var t=this.getHostInstance();if(e&&!t){u.error("sap.ui.integration.designtime.editor.CardEditor: Host with id '"+e+"' is not available during card editor initialization. It must be available for host specific features to work.","Make sure that the host already exists, before assigning it to the card editor.","sap.ui.integration.designtime.editor.CardEditor")}this._oDestinations=this._oEditorCard._oDestinations};f.prototype.propagateModels=function(e,t,i){var r=l({},e.oPropagatedProperties.oModels,e.oModels),s=Object.keys(r),o=e.getModel();if(o){t.setModel(o)}i=i||[];s.forEach(function(r){if(r==="undefined"){return}if(i.includes(r)){return}var s=e.getModel(r);if(s){t.setModel(s,r)}})};f.prototype.createManifest=async function(e,t){this._isManifestReady=false;if(this._oManifest){this._oManifest.destroy()}this.destroyAggregation("_extension");var i=o.layers[this.getMode()];this._oManifest=this._oEditorCard._oCardManifest;this._registerManifestModulePath();var s=this._oManifest._oInitialJson;this._oInitialManifestModel=new n(s);this.setProperty("json",s,t);var h;if(this._oBeforeLayerChange){h=o.mergeDelta(s,[this._oBeforeLayerChange])}else{h=s}var g=a({},h);this._oBeforeLayerManifestModel=new n(g);if(i<o.layers["translation"]&&this._oCurrentLayerChange){h=o.mergeDelta(h,[this._oCurrentLayerChange])}this._oManifestModel=new n(h);this._isManifestReady=true;this.fireManifestReady();this._initResourceBundlesForMultiTranslation();if(this.getMode()===r.EDITOR_MODE.TRANSLATION){await this._loadSpecialTranslations()}this._createContextModel();if(this._oManifest&&this._oManifest.getResourceBundle()){var l=this._oManifest.getResourceBundle();var _=new d({bundle:l});await _.getResourceBundle();this.setModel(_,"i18n");if(this._oResourceBundle){await _.enhance(this._oResourceBundle)}this._oResourceBundle=await _.getResourceBundle()}return this._loadExtension().then(function(){this._initInternal()}.bind(this))};f.prototype._initPreview=function(){var e=this._oDesigntimeInstance.getSettings()||{};e.preview=e.preview||{};e.preview.position=this.getPreviewPosition();var t=new g({settings:e,card:this._oEditorCard,parentWidth:this._oChildTree&&this._editorWidth?this._editorWidth:this.getWidth(),parentHeight:this.getHeight()});if(this._oChildTree&&this._previewSize){t._currentSize=this._previewSize}this.setAggregation("_preview",t);t.setAssociation("_editor",this);return t};f.prototype._destoryPreview=function(){var e=this.getAggregation("_preview");if(e){this._editorWidth=e.getParentWidth();this._previewSize=e._currentSize;e.destroy(false);this.setAggregation("_preview",null)}};f.prototype._loadExtension=function(){return new Promise(function(e,t){var i=this._oEditorCard.getAggregation("_extension");this.setAggregation("_extension",i);e()}.bind(this))};f.prototype._mergeContextData=function(e){var t={};t["empty"]=c.empty;for(var i in e){t[i]=e[i]}t["card.internal"]=c["card.internal"];return t};f.initContextEntries=function(){return{empty:{label:i.oResourceBundle.getText("CARDEDITOR_CONTEXT_EMPTY_VAL"),type:"string",description:i.oResourceBundle.getText("CARDEDITOR_CONTEXT_EMPTY_DESC"),placeholder:"",value:""},"card.internal":{label:i.oResourceBundle.getText("CARDEDITOR_CONTEXT_CARD_INTERNAL_VAL"),todayIso:{type:"string",label:i.oResourceBundle.getText("CARDEDITOR_CONTEXT_CARD_TODAY_VAL"),description:i.oResourceBundle.getText("CARDEDITOR_CONTEXT_CARD_TODAY_DESC"),tags:[],placeholder:i.oResourceBundle.getText("CARDEDITOR_CONTEXT_CARD_TODAY_VAL"),customize:["format.dataTime"],value:"{{parameters.TODAY_ISO}}"},nowIso:{type:"string",label:i.oResourceBundle.getText("CARDEDITOR_CONTEXT_CARD_NOW_VAL"),description:i.oResourceBundle.getText("CARDEDITOR_CONTEXT_CARD_NOW_DESC"),tags:[],placeholder:i.oResourceBundle.getText("CARDEDITOR_CONTEXT_CARD_NOW_VAL"),customize:["dateFormatters"],value:"{{parameters.NOW_ISO}}"},currentLanguage:{type:"string",label:i.oResourceBundle.getText("CARDEDITOR_CONTEXT_CARD_LANG_VAL"),description:i.oResourceBundle.getText("CARDEDITOR_CONTEXT_CARD_LANG_VAL"),tags:["technical"],customize:["languageFormatters"],placeholder:i.oResourceBundle.getText("CARDEDITOR_CONTEXT_CARD_LANG_VAL"),value:"{{parameters.LOCALE}}"}}}};c=f.initContextEntries();f.prototype._applyLanguageChange=function(){c=f.initContextEntries()};return f});
//# sourceMappingURL=CardEditor.js.map