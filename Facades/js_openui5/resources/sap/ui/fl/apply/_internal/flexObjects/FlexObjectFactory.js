/* !
 * OpenUI5
 * (c) Copyright 2026 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/restricted/_pick","sap/base/util/isPlainObject","sap/base/util/ObjectPath","sap/ui/fl/apply/_internal/controlVariants/Utils","sap/ui/fl/apply/_internal/flexObjects/AnnotationChange","sap/ui/fl/apply/_internal/flexObjects/AppDescriptorChange","sap/ui/fl/apply/_internal/flexObjects/CompVariant","sap/ui/fl/apply/_internal/flexObjects/ControllerExtensionChange","sap/ui/fl/apply/_internal/flexObjects/FlexObject","sap/ui/fl/apply/_internal/flexObjects/FlVariant","sap/ui/fl/apply/_internal/flexObjects/States","sap/ui/fl/apply/_internal/flexObjects/UIChange","sap/ui/fl/apply/_internal/flexObjects/UpdatableChange","sap/ui/fl/apply/_internal/flexObjects/VariantChange","sap/ui/fl/apply/_internal/flexObjects/VariantManagementChange","sap/ui/fl/initial/_internal/Settings","sap/ui/fl/Layer","sap/ui/fl/LayerUtils","sap/ui/fl/Utils"],function(e,t,n,a,r,i,c,o,l,s,p,f,u,g,y,m,C,O,N){"use strict";const d={COMP_VARIANT_OBJECT:c,FL_VARIANT_OBJECT:s,CONTROLLER_EXTENSION:o,APP_DESCRIPTOR_CHANGE:i,ANNOTATION_CHANGE:r,UI_CHANGE:f,UPDATABLE_CHANGE:u,VARIANT_CHANGE:g,VARIANT_MANAGEMENT_CHANGE:y,FLEX_OBJECT:l};function _(e){return t(e)?{...e}:e}function T(e){if(e.fileType==="variant"){return d.COMP_VARIANT_OBJECT}else if(e.fileType==="ctrl_variant"){return d.FL_VARIANT_OBJECT}else if(e.changeType==="codeExt"){return d.CONTROLLER_EXTENSION}else if(e.appDescriptorChange){return d.APP_DESCRIPTOR_CHANGE}else if(e.fileType==="annotation_change"){return d.ANNOTATION_CHANGE}else if(e.fileType==="change"&&e.changeType==="defaultVariant"){return d.UPDATABLE_CHANGE}else if(e.fileType==="ctrl_variant_change"){return d.VARIANT_CHANGE}else if(e.fileType==="ctrl_variant_management_change"){return d.VARIANT_MANAGEMENT_CHANGE}else if(e.changeType==="deactivateChanges"){return d.FLEX_OBJECT}return d.UI_CHANGE}function A(e){const t=_(e);const n=t.type||t.changeType;let a=t.fileName||t.id;if(!a){a=N.createDefaultFileName(n);if(a.length>64){throw Error(`File name '${a}' must not exceed 64 characters`)}}const r=t.user||(!O.isDeveloperLayer(t.layer)?m.getInstanceOrUndef()?.getUserId():undefined);return{id:a,adaptationId:t.adaptationId,layer:t.layer,content:_(t.content),texts:_(t.texts),supportInformation:{service:t.ODataService,oDataInformation:_(t.oDataInformation),command:t.command,compositeCommand:t.compositeCommand,generator:t.generator,sourceChangeFileName:t.support&&t.support.sourceChangeFileName,sourceSystem:t.sourceSystem,sourceClient:t.sourceClient,originalLanguage:t.originalLanguage,user:r},flexObjectMetadata:{changeType:n,reference:t.reference,packageName:t.packageName,projectId:t.projectId}}}const E={};E.createFromFileContent=function(e,t,a){const r={...e};var i=t||T(r);if(!i){throw new Error("Unknown file type")}r.support={generator:"FlexObjectFactory.createFromFileContent",...r.support||{}};const c=i.getMappingInfo();const o=l.mapFileContent(r,c);const s=Object.entries(o).reduce(function(e,t){n.set(t[0].split("."),t[1],e);return e},{});const f=new i(s);if(a){f.setProperty("state",p.LifecycleState.PERSISTED)}return f};E.createFlexObject=function(e){const t=A({...e,...{packageName:e.packageName||"$TMP"}});return new l(t)};E.createUIChange=function(e){e.packageName||="$TMP";const t=A(e);t.layer||=e.isUserDependent?C.USER:O.getCurrentLayer();t.selector=e.selector;t.jsOnly=e.jsOnly;t.variantReference=e.variantReference;t.isChangeOnStandardVariant=e.isChangeOnStandardVariant;t.fileType=e.fileType||"change";return new f(t)};E.createVariantChange=function(e){e.packageName||="$TMP";const t=A(e);t.variantId=e.variantId||e.selector?.id;t.fileType=e.fileType||"ctrl_variant_change";return new g(t)};E.createVariantManagementChange=function(e){e.packageName||="$TMP";const t=A(e);t.selector=e.selector;t.fileType=e.fileType||"ctrl_variant_management_change";return new y(t)};E.createAppDescriptorChange=function(e){e.compositeCommand||=e.support&&e.support.compositeCommand;if(!(e.fileName||e.id)){const t=e.type||e.changeType;e.fileName=N.createDefaultFileName(t).substring(0,64)}const t=A(e);return new i(t)};E.createAnnotationChange=function(e){e.compositeCommand||=e.support&&e.support.compositeCommand;const t=A(e);t.serviceUrl=e.serviceUrl;return new r(t)};E.createControllerExtensionChange=function(e){e.generator||="FlexObjectFactory.createControllerExtensionChange";e.changeType="codeExt";e.content={codeRef:e.codeRef};if(e.viewId){e.content.viewId=e.viewId}const t=A(e);t.flexObjectMetadata.moduleName=e.moduleName;t.controllerName=e.controllerName;return new o(t)};E.createFlVariant=function(e){const t=_(e);t.generator||="FlexObjectFactory.createFlVariant";if(t.layer===C.VENDOR){t.user=a.DEFAULT_AUTHOR}const n=A(t);n.variantManagementReference=t.variantManagementReference;n.variantReference=t.variantReference;n.contexts=t.contexts;n.executeOnSelection=t.executeOnSelection;n.texts={variantName:{value:t.variantName,type:"XFLD"}};return new s(n)};E.createCompVariant=function(e){const t=_(e);t.generator||="FlexObjectFactory.createCompVariant";t.user=n.get("support.user",t);const a=A(t);a.variantId=t.variantId||a.id;a.contexts=t.contexts;a.favorite=t.favorite;a.persisted=t.persisted;if(t.persistencyKey!==undefined){a.persistencyKey=t.persistencyKey}else{a.persistencyKey=n.get("selector.persistencyKey",t)}if(t.layer===C.VENDOR||t.layer===C.CUSTOMER_BASE){a.favorite=true}if(t.executeOnSelection!==undefined){a.executeOnSelection=t.executeOnSelection}else{a.executeOnSelection=a.content&&(a.content.executeOnSelect||a.content.executeOnSelection)}return new c(a)};return E});
//# sourceMappingURL=FlexObjectFactory.js.map