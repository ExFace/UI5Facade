/*!
 * OpenUI5
 * (c) Copyright 2026 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/apply/_internal/flexState/FlexObjectState","sap/ui/fl/initial/_internal/FlexInfoSession","sap/ui/fl/initial/_internal/ManifestUtils","sap/ui/fl/initial/api/Version","sap/ui/fl/write/_internal/flexState/FlexObjectManager","sap/ui/fl/write/_internal/Versions","sap/ui/fl/write/api/ContextBasedAdaptationsAPI","sap/ui/fl/write/api/FeaturesAPI","sap/ui/fl/Utils","sap/ui/fl/write/_internal/init"],function(e,r,t,n,o,i,a,s,l){"use strict";function c(e){const r=t.getFlexReferenceForControl(e);if(!r){throw Error("The application ID could not be determined")}return r}function d(r){const t=e.getDirtyFlexObjects(r);return t.length>0}function f(e){if(!e.control){throw Error("No control was provided")}if(!e.layer){throw Error("No layer was provided")}var r=c(e.control);const t=i.getVersionsModel({reference:r,layer:e.layer});if(d(r)){t.updateDraftVersion()}return t}function p(e){var r=c(e.control);var t=a.hasAdaptationsModel({layer:e.layer,reference:r});if(!e.adaptationId&&t){return a.refreshAdaptationModel(e)}else if(e.adaptationId&&t){var n=a.getAdaptationsModel(e);n.switchDisplayedAdaptation(e.adaptationId);return Promise.resolve(e.adaptationId)}return Promise.resolve()}var u={};u.initialize=function(e){if(!e.control){return Promise.reject("No control was provided")}if(!e.layer){return Promise.reject("No layer was provided")}var r=l.getAppComponentForControl(e.control);return i.initialize({reference:c(r),layer:e.layer})};u.clearInstances=function(){i.clearInstances()};u.isDraftAvailable=function(e){var r=f(e);var t=r.getProperty("/versions");var o=t.find(function(e){return e.version===n.Number.Draft});return!!o};u.getDraftFilenames=function(e){const r=f(e);return r.getProperty("/draftFilenames")};u.isOldVersionDisplayed=function(e){var r=f(e);var t=r.getProperty("/displayedVersion");var o=r.getProperty("/activeVersion");return t!==n.Number.Draft&&t!==o};u.loadDraftForApplication=function(e){e.version=n.Number.Draft;return u.loadVersionForApplication(e)};u.loadVersionForApplication=async function(e){if(!e.control){throw Error("No control was provided")}if(!e.layer){throw Error("No layer was provided")}const t=f(e);if(t){if(e.version===undefined){e.version=t.getProperty("/activeVersion")}t.setProperty("/displayedVersion",e.version);t.setProperty("/persistedVersion",e.version);const r=await s.isPublishAvailable();if(e.version!==n.Number.Draft&&r){const r=t.getProperty("/versions");if(r.length){const n=r.find(function(r){return r.version===e.version});if(n){t.setProperty("/publishVersionEnabled",!n.isPublished)}}}}const o=await p(e);const i=l.getAppComponentForControl(e.control);const a=c(i);const d=r.getByReference(a);d.version=e.version;d.displayedAdaptationId=o;r.setByReference(d,a)};u.activate=function(e){if(!e.control){return Promise.reject("No control was provided")}if(!e.layer){return Promise.reject("No layer was provided")}if(!e.title){return Promise.reject("No version title was provided")}const t=c(e.control);if(d(t)){return Promise.reject("Unsaved changes exist")}const n=r.getByReference(t);delete n.version;r.setByReference(n,t);return i.activate({reference:t,layer:e.layer,title:e.title,appComponent:l.getAppComponentForControl(e.control),displayedVersion:e.displayedVersion})};u.discardDraft=function(t){const n=l.getAppComponentForControl(t.control);const s=c(n);function d(){const r=e.getDirtyFlexObjects(s);o.deleteFlexObjects({reference:s,flexObjects:r});return r.length>0}if(!t.control){return Promise.reject("No control was provided")}if(!t.layer){return Promise.reject("No layer was provided")}return i.discardDraft({reference:s,layer:t.layer,discardDraftAndKeepActiveVersion:t.discardDraftAndKeepActiveVersion}).then(function(e){var n=false;if(!t.discardDraftAndKeepActiveVersion){n=d()}e.dirtyChangesDiscarded=n;if(e.backendChangesDiscarded){const n=a.hasAdaptationsModel({layer:t.layer,reference:s});if(n){return a.refreshAdaptationModel(t).then(function(t){const n=r.getByReference(s);n.displayedAdaptationId=t;r.setByReference(n,s);return e})}}return e})};u.publish=function(e){if(!e.selector){return Promise.reject("No selector was provided")}if(!e.layer){return Promise.reject("No layer was provided")}if(!e.version){return Promise.reject("No version was provided")}e.styleClass||="";e.reference=c(e.selector);return i.publish(e)};u.getCreatedVersionsByUser=function(e,r){const t=f(e);const n=t.getProperty("/versions");return n.filter(e=>e.activatedBy===r)};return u});
//# sourceMappingURL=VersionsAPI.js.map