/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/rta/plugin/Plugin","sap/ui/dt/Util","sap/ui/fl/Utils","sap/ui/fl/apply/api/ExtensionPointRegistryAPI","sap/ui/fl/apply/_internal/flexState/ManifestUtils","sap/base/util/values","sap/ui/base/DesignTime"],function(t,n,e,i,o,r,a){"use strict";const s=t.extend("sap.ui.rta.plugin.AddXMLAtExtensionPoint",{metadata:{library:"sap.ui.rta",properties:{fragmentHandler:{type:"function"}},associations:{},events:{}}});const u="addXMLAtExtensionPoint";const c="appdescr_ui5_setFlexExtensionPointEnabled";function l(t){const n=t.getId();const e=i.getExtensionPointInfoByParentId({parentId:n});return e.length?e:r(i.getExtensionPointInfoByViewId({viewId:n}))}function d(t){return l(t).length>0}function f(){return a.isDesignModeEnabled()}function m(t){const n=l(t.getElement())[0]?.view;return n&&e.checkControlId(n)}s.prototype.bManifestCommandAlreadyAvailable=false;s.prototype._isEditable=function(t){if(f()){const n=t.getElement();return this.hasChangeHandler(u,n).then(function(e){return e&&d(n)&&m(t)})}return Promise.resolve(false)};s.prototype.isEnabled=function(t){const n=t.length===1;return n&&!!m(t[0])};s.prototype.isAvailable=function(t){if(f()){const n=t[0].getElement();return d(n)}return false};function p(t,n,i){const o=n.extensionPointName;const r=e.getViewForControl(t);const a={name:o,view:r};const s={fragment:n.fragment,fragmentPath:n.fragmentPath};return this.getCommandFactory().getCommandFor(a,u,s).then(function(t){return i.addCommand(t)})}function g(t,n){const i=o.isFlexExtensionPointHandlingEnabled(t);if(i||this.bManifestCommandAlreadyAvailable){return Promise.resolve()}const r=e.getAppComponentForControl(t);const a=r.getManifestEntry("sap.app").id;return this.getCommandFactory().getCommandFor(t,"manifest",{reference:a,appComponent:r,changeType:c,parameters:{flexExtensionPointEnabled:true},texts:{}}).then(function(t){this.bManifestCommandAlreadyAvailable=true;return n.addCommand(t)}.bind(this))}function h(t,n){let e;const i=t[0];const o=i.getElement();return this.getCommandFactory().getCommandFor(o,"composite").then(function(t){e=t}).then(function(){return p.call(this,o,n,e)}.bind(this)).then(function(){return g.call(this,o,e)}.bind(this)).then(function(){return e})}s.prototype.handler=function(t,e){return Promise.resolve().then(function(){const n=e.fragmentHandler||this.getFragmentHandler();if(!n){return Promise.reject("Fragment handler function is not available in the handler")}const i=t[0];const o=i.getElement();const r=l(o);return n(i,r)}.bind(this)).then(function(t){if(!t.extensionPointName||!(typeof t.extensionPointName==="string")){return Promise.reject("Extension point name is not selected!")}if(!t.fragmentPath||!(typeof t.fragmentPath==="string")){return Promise.reject("Fragment path is not available")}return t}).then(function(n){return h.call(this,t,n)}.bind(this)).then(function(t){this.fireElementModified({command:t})}.bind(this)).catch(function(t){throw n.propagateError(t,"AddXMLAtExtensionPoint#handler","Error occurred in AddXMLAtExtensionPoint handler function","sap.ui.rta")})};s.prototype.getMenuItems=function(t){return this._getMenuItems(t,{pluginId:"CTX_ADDXML_AT_EXTENSIONPOINT",icon:"sap-icon://add-equipment"})};s.prototype.getActionName=function(){return"AddXMLAtExtensionPoint"};s.prototype.getAction=function(){return{changeType:u}};return s});
//# sourceMappingURL=AddXMLAtExtensionPoint.js.map