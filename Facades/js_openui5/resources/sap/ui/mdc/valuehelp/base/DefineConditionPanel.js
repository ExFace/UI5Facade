/*!
 * OpenUI5
 * (c) Copyright 2026 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Control","sap/ui/base/ManagedObjectObserver","sap/base/i18n/Localization","sap/base/util/merge","sap/base/util/deepEqual","sap/ui/core/Element","sap/ui/core/Lib","sap/ui/core/Messaging","sap/ui/mdc/condition/Condition","sap/ui/mdc/condition/FilterOperatorUtil","sap/ui/mdc/field/ConditionsType","sap/ui/mdc/field/ConditionType","sap/ui/mdc/field/splitValue","sap/ui/mdc/enums/FieldEditMode","sap/ui/mdc/enums/FieldDisplay","sap/ui/mdc/enums/BaseType","sap/ui/mdc/enums/ConditionValidated","sap/ui/mdc/enums/OperatorValueType","sap/ui/mdc/Field","sap/ui/mdc/ValueHelp","sap/ui/mdc/valuehelp/Popover","sap/ui/mdc/valuehelp/content/FixedList","sap/ui/mdc/valuehelp/content/FixedListItem","sap/ui/model/base/ManagedObjectModel","sap/ui/model/json/JSONModel","sap/ui/model/resource/ResourceModel","sap/ui/model/type/String","sap/ui/model/ParseException","sap/ui/core/library","sap/ui/core/InvisibleText","sap/ui/layout/Grid","sap/ui/layout/GridData","sap/m/library","sap/m/Button","sap/m/Panel","sap/m/OverflowToolbar","sap/m/OverflowToolbarLayoutData","sap/m/ToolbarSpacer","sap/m/Text","sap/m/Title","sap/ui/core/IconPool","sap/ui/core/InvisibleMessage","sap/ui/thirdparty/jquery"],(t,e,i,n,s,o,a,l,r,d,c,u,h,p,g,f,C,y,v,I,m,O,_,b,T,x,S,D,N,w,P,V,E,M,$,L,A,B,F,R,U,H,jQuery)=>{"use strict";let k=a.getResourceBundleFor("sap.ui.mdc");let j=a.getResourceBundleFor("sap.m");i.attachChange(()=>{k=a.getResourceBundleFor("sap.ui.mdc");j=a.getResourceBundleFor("sap.m")});const{ButtonType:G}=E;const{ValueState:X}=N;const{InvisibleMessageMode:K}=N;const{TextAlign:W}=N;const{BackgroundDesign:q}=E;const{ToolbarDesign:Y}=E;const{OverflowToolbarPriority:z}=E;const J=t.extend("sap.ui.mdc.valuehelp.base.DefineConditionPanel",{metadata:{library:"sap.ui.mdc",properties:{conditions:{type:"object[]",group:"Data",defaultValue:[],byValue:true},config:{type:"object",defaultValue:{}},label:{type:"string",defaultValue:""},inputOK:{type:"boolean",defaultValue:true},_pagination:{type:"boolean",defaultValue:false,visibility:"hidden"},_prevButtonActive:{type:"boolean",defaultValue:false,visibility:"hidden"},_nextButtonActive:{type:"boolean",defaultValue:false,visibility:"hidden"}},aggregations:{_content:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"}},associations:{fieldHelp:{type:"sap.ui.mdc.ValueHelp",multiple:false},valueHelp:{type:"sap.ui.mdc.ValueHelp",multiple:false}},events:{conditionProcessed:{}}},_oManagedObjectModel:null,renderer:{apiVersion:2,render:function(t,e){t.openStart("section",e);t.class("sapUiMdcDefineConditionPanel");t.openEnd();t.renderControl(e.getAggregation("_content"));t.close("section")}},init:function(){l.registerObject(this,true);t.prototype.init.apply(this,arguments);this.oInvisibleMessage=H.getInstance();this._oManagedObjectModel=new b(this);this._oObserver=new e(et.bind(this));this._oObserver.observe(this,{properties:["conditions","config"]});this._iStartIndex=0;this._iShownConditions=10;this._iShownAdditionalConditions=0;this._sOperatorHelpId=this.getId()+"--rowSelect-help";this._oContentEventDelegate={onpaste:this.onPaste};this._oConditionType=new u;Ct.call(this);this.setModel(this._oManagedObjectModel,"$this");this.setModel(this._oManagedObjectModel,"$condition")},exit:function(){l.unregisterObject(this,true);this._oObserver.disconnect();this._oObserver=undefined;if(this._sConditionsTimer){clearTimeout(this._sConditionsTimer);this._sConditionsTimer=null}if(this._oDefaultType){this._oDefaultType.destroy();delete this._oDefaultType}this._oManagedObjectModel.destroy();delete this._oManagedObjectModel;this._oConditionType.destroy();delete this._oConditionType},byId:function(t){return o.getElementById(this.getId()+"--"+t)},onBeforeRendering:function(){if(!this.getModel("$i18n")){this.setModel(new x({bundleName:"sap/ui/mdc/messagebundle",async:true}),"$i18n")}if(this.getConditions().length===0&&!this._sConditionsTimer){this.updateDefineConditions()}},removeCondition:function(t){const{oSource:e}=t;const i=e.getBindingContext("$this");let n=this.getConditions();const s=i.getPath();const o=s.match(/^.*\/(\d+)\/$/);let a;if(o){a=parseInt(o[1])}if(a>0&&n.length-1===a){this._bFocusLastRemoveBtn=true}this.oInvisibleMessage.announce(k.getText("valuehelp.DEFINECONDITIONS_REMOVECONDITION_ANNOUNCE"),K.Assertive);const l=this.byId("conditions");const r=l.getContent();let d=-1;for(const t of r){if(t instanceof v&&t.getValueHelp()===this._sOperatorHelpId){d++}if(t instanceof v&&t.hasOwnProperty("_iValueIndex")&&t.getBindingContext("$this").getPath().startsWith(s)){if(t.isInvalidInput()){t.setValue(null)}}}if(n.length===1&&a===0){this.addDummyCondition(1);n=this.getConditions()}if(d===0&&this._iStartIndex>0){this._iStartIndex=this._iStartIndex-this._iShownConditions}n.splice(a,1);this.setProperty("conditions",n,true);this.fireConditionProcessed()},addCondition:function(t){const e=this.getConditions();const i=this.getConfig();const n=i.maxConditions;const s=this.byId("conditions");const o=s.getContent();let a=0;let l=-1;for(const t of o){if(t instanceof v&&t.getValueHelp()===this._sOperatorHelpId){a++;const e=t.getBindingContext("$this");const i=e.getPath();const n=i.match(/^.*\/(\d+)\/$/);if(n){l=parseInt(n[1])}}}if(n===-1||e.length<n){this.addDummyCondition(l+1);this._bFocusLastCondition=true;if(a>=this._iShownConditions){this._iShownAdditionalConditions++}}this.oInvisibleMessage.announce(k.getText("valuehelp.DEFINECONDITIONS_ADDCONDITION_ANNOUNCE"),K.Assertive)},addDummyCondition:function(t){const e=rt.call(this);const i=lt.call(this);const n=i.name;const s=r.createCondition(n,i.valueDefaults?i.valueDefaults:[],undefined,undefined,C.NotValidated);if(i.valueTypes[0]&&i.valueTypes[0]!==y.Static){s.isInitial=true}d.updateConditionValues(s);d.checkConditionsEmpty(s,e);const o=this.getConditions();if(t!==undefined){o.splice(t,0,s)}else{o.push(s)}this.setProperty("conditions",o,true);if(!s.isInitial){this.fireConditionProcessed()}},updateDefineConditions:function(){const t=Bt.call(this);ft.call(this,t,true,this._bUpdateType);if(t.length===0){this.addDummyCondition()}if(t.length<this._iStartIndex){this._iStartIndex=0}},onChange:function(t){const e=t&&t.getParameter("promise");const i=t&&t.getSource();const n=function(t,e){const i=rt.call(this);const n=this.getConditions();d.checkConditionsEmpty(n,i);d.updateConditionsValues(n,i);ft.call(this,n,false,false);if(t){n.forEach(t=>{if(!t.isEmpty){delete t.isInitial}})}this.setProperty("conditions",n,true);if(s(n,this.getConditions())){const t=tt(e);if(t){t.getBinding("text").checkUpdate(true)}}}.bind(this);if(e){e.then(t=>{this._bPendingChange=false;n({mParameters:{value:t}},i);if(this._bPendingValidateCondition){Lt.call(this,i);delete this._bPendingValidateCondition}}).catch(t=>{this._bPendingChange=false;$t(i);if(this._bPendingValidateCondition){Lt.call(this,i);delete this._bPendingValidateCondition}});if(i){Z(i)}this._bPendingChange=true;return}else{n(undefined,i)}},onSelectChange:function(t){const e=t.getSource();const i=t.getParameter("promise");i.then(t=>{const i=e._sOldKey;const n=d.getOperator(t);const o=i&&d.getOperator(i);const a=e.getBindingContext("$this");let l=a.getObject();const r=a.getPath();const c=parseInt(r.split("/")[2]);const u=this.getConditions();if(c>=0){l=u[c]}if(n&&o){let a=false;if(!s(n.valueTypes[0],o.valueTypes[0])&&n.valueTypes[0]!==y.Static){if(c>=0){l.values.forEach((t,e)=>{if(t!==null){if(n.valueTypes[e]===y.Self&&o.valueTypes[e]===y.SelfNoParse||n.valueTypes[e]===y.SelfNoParse&&o.valueTypes[e]===y.Self){const t=ot.call(this,n.name,e);const i=ot.call(this,o.name,e);const s=i.formatValue(l.values[e],"string");const r=t.parseValue(s,"string");if(r!==l.values[e]){l.values[e]=t.parseValue(s,"string");a=true}}else{l.values[e]=null;a=true}}})}}let r=false;if(n.valueTypes.length===0||n.valueTypes[0]===y.Static){for(let i=0;i<u.length;i++){if(i!==c&&t===u[i].operator){r=true;l.invalid=true;a=true;Mt(e,k.getText("field.CONDITION_ALREADY_EXIST",[t]));break}}}if(o.valueTypes.length===0||o.valueTypes[0]===y.Static){let t=-1;let e=false;for(let n=0;n<u.length;n++){if(i===u[n].operator){if(t<0){t=n}else{e=true;break}}}if(!e&&t>=0){delete u[t].invalid;a=true}}if(c>=0&&n.valueDefaults){l.values.forEach((t,e)=>{if(l.isInitial&&t!==n.valueDefaults[e]||t===null){l.values[e]=n.valueDefaults[e];l.isInitial=true;a=true}})}if(!n.valueTypes[1]&&o.valueTypes[1]){if(c>=0){if(l.values.length>1&&l.values[1]){l.values=l.values.slice(0,1);a=true}}}if(l.invalid&&!r){delete l.invalid;a=true}if(a){d.checkConditionsEmpty(l,rt.call(this));this.setProperty("conditions",u,true)}if(!l.invalid&&(n.valueTypes.length===0||n.valueTypes[0]===y.Static||(o.valueTypes.length===0||o.valueTypes[0]===y.Static))){this.fireConditionProcessed()}}delete e._sOldKey}).catch(t=>{const i=e.getBindingContext("$this");let n=i.getObject();const s=i.getPath();const o=parseInt(s.split("/")[2]);const a=this.getConditions();if(o>=0){n=a[o]}n.invalid=true;this.setProperty("conditions",a,true);e._sOldKey=e.getValue()})},onPaste:function(t){const e=t.originalEvent.clipboardData.getData("text/plain");const i=h(e,true);if(i.length>1){const i=t.srcControl;const n=i.getBindingContext("$condition").getPath();const s=parseInt(n.split("/")[2]);const o=this.getConditions();const a=Q(this.getConfig(),o,s);const l=new c(a);o.splice(s,1);l._parseValueToIndex(e,"string",s).then(t=>{l.validateValue(t);d.checkConditionsEmpty(t);this.setProperty("conditions",t,true);this.fireConditionProcessed();l.destroy()}).catch(t=>{const n=new D(k.getText("field.PASTE_ERROR"));const s={element:i,property:"value",type:l,newValue:e,oldValue:"",exception:n,message:n.message};i.fireParseError(s,false,true);l.destroy()});t.stopImmediatePropagation(true);t.preventDefault()}},cleanUp:function(){const t=this.byId("conditions");const e=t.getContent();for(const t of e){if(t instanceof v&&t.hasOwnProperty("_iValueIndex")){if(t.isInvalidInput()){t.setValue()}}}this.setProperty("inputOK",true,true);if(this._iStartIndex>0||this._iShownAdditionalConditions>0){this._iStartIndex=0;this._iShownAdditionalConditions=0;It.call(this)}},getInitialFocusedControl:function(){const t=this.getAggregation("_content").getContent()[1];const e=t.getContent()[0];return e},getFocusControlAfterTokenRemoval:function(){const t=this.getAggregation("_content").getContent()[1];const e=t.getContent();const i=e[2]?e[2]:e[0];return i},_getValueHelp:function(){return this.getValueHelp()||this.getFieldHelp&&this.getFieldHelp()}});function Q(t,e,i){const s=e[i];const o=n({},t);o.display=g.Value;o.getConditions=function(){return e};o.defaultOperatorName=s?.operator;o.valueType=o.dataType;delete o.dataType;return o}function Z(t){const e=tt(t);if(e){e.setText("")}}function tt(t){if(!t){return null}const e=t.getParent();const i=e.getContent().indexOf(t);const n=e.getContent().find((t,e)=>t.isA("sap.ui.core.InvisibleText")&&e>i);return n}function et(t){if(t.name==="value"){nt.call(this,t.object,t.current,t.old)}if(t.name==="config"){const e=this.getConditions();const i=t.current&&t.current.operators;const n=t.old&&t.old.operators;let o=false;if(!s(i,n)){o=true;ct.call(this)}const a=t.current&&t.current.dataType;const l=t.old&&t.old.valueType;const r=a&&a.getMetadata().getName();const d=l&&l.getMetadata().getName();const c=a&&a.getFormatOptions();const u=l&&l.getFormatOptions();const h=a&&a.getConstraints();const p=l&&l.getConstraints();const g=Q(t.current,e,-1);this._oConditionType.setFormatOptions(g);if(r!==d||!s(c,u)||!s(h,p)){if(!o){ct.call(this)}if(this._sConditionsTimer){this._bUpdateType=true}else if(e.length>0){this._bUpdateType=true;It.call(this);this._bUpdateType=false;ft.call(this,e,true,true)}}}if(t.name==="conditions"&&!this._bConditionUpdateRunning){if(this._sConditionsTimer){clearTimeout(this._sConditionsTimer);this._sConditionsTimer=null}this._sConditionsTimer=setTimeout(()=>{this._sConditionsTimer=null;this._bConditionUpdateRunning=true;this.updateDefineConditions();It.call(this);this._bUpdateType=false;this._bConditionUpdateRunning=false},0)}}function it(t){return true}function nt(t,e,i){t._sOldKey=i;let n=0;let s;if(i){const s=e&&d.getOperator(e);const o=d.getOperator(i);const a=t.getParent();let l;let r;n=a.indexOfContent(t);l=a.getContent()[n+2];if(l?.hasOwnProperty("_iValueIndex")&&l._iValueIndex===0){if(l instanceof v&&!l.isInvalidInput()){l.setValueState(X.None);l.setValueStateText()}r=a.getContent()[n+3];if(r?.hasOwnProperty("_iValueIndex")&&r._iValueIndex===1){if(r instanceof v&&!r.isInvalidInput()){r.setValueState(X.None);r.setValueStateText()}}else{r=undefined}}else{l=undefined}let c;if(e&&it(e)){c=this._getValueHelp()}l?.setValueHelp?.(c);r?.setValueHelp?.(c);if(s?.createControl||o?.createControl){l?.destroy();r?.destroy()}else{if(l&&s?.valueTypes[0]!==o?.valueTypes[0]){l.unbindProperty("value")}if(r&&s?.valueTypes[1]!==o?.valueTypes[1]&&o?.valueTypes[1]){r.unbindProperty("value")}}}if(!e){s=t.getBindingContext("$this").getObject();if(s){const t=this.getConditions();n=d.indexOfCondition(s,t);if(n>=0){s=t[n];s.operator=i;this.setProperty("conditions",t,true)}}}const o=this.oOperatorModel.getData();let a;for(const t of o){if(t.key===e){a=t.text;break}}t.setAdditionalValue(a);this.onChange(undefined)}function st(t,e,i,n){const s=d.getOperator(t.operator);if(!s||!s.valueTypes[e]){return null}const o=ot.call(this,s.name,e);const a=this._oManagedObjectModel.getContext(n.getPath()+"values/"+e+"/");let l;if(s.createControl){l=s.createControl(o,"$this>",e,i)}if(!l){l=new v(i,{delegate:gt.call(this),value:{path:"$this>",type:o,mode:"TwoWay",targetType:"raw"},editMode:{parts:[{path:"$condition>operator"},{path:"$condition>invalid"}],formatter:xt},multipleLines:false,width:"100%",valueHelp:it(t.operator)?this._getValueHelp():null})}if(l.getMetadata().hasProperty("placeholder")){if(e===0){l.bindProperty("placeholder",{path:"$condition>operator",formatter:wt})}else{l.bindProperty("placeholder",{path:"$condition>operator",formatter:Pt})}}l._iValueIndex=e;if(l.attachChange){l.attachChange(this.onChange.bind(this))}l.addDelegate(this._oContentEventDelegate,true,this);l.setLayoutData(new V({span:{parts:[{path:"$condition>"},{path:"$this>/config"}],formatter:Nt.bind(this)}}));l.setBindingContext(a,"$this");l.setBindingContext(n,"$condition");l.setFieldGroupIds([n.getPath()]);return l}function ot(t,e){let i=ut.call(this);const n=d.getOperator(t);if(n.valueTypes[e]&&[y.Self,y.Static].indexOf(n.valueTypes[e])===-1){i=n._createLocalType(n.valueTypes[e],i)}let s=false;if(n.valueTypes[e]===y.Static){s=true;i=ht.call(this)}const o=s?f.String:pt.call(this,i);let a;const l=i.getFormatOptions();switch(o){case f.Numeric:if(l&&l.hasOwnProperty("emptyString")&&l.emptyString===null){a=i}else{a=at(i,{emptyString:null})}break;case f.Date:case f.Time:case f.DateTime:a=i;break;default:if(i.getConstraints()&&i.getConstraints().hasOwnProperty("nullable")&&i.getConstraints().nullable===false){a=at(i);if(i._bCreatedByOperator){a=n._createLocalType(n.valueTypes[e],i)}}else{a=i}break}return a}function at(t,e,i){const s=sap.ui.require(t.getMetadata().getName().replace(/\./g,"/"));const o=n(t.getFormatOptions(),e||{});const a=n(t.getConstraints(),i||{});if(a.hasOwnProperty("nullable")&&a.nullable===false){a.nullable=true}return new s(o,a)}function lt(){const t=rt.call(this);let e;const i=this.getConfig().defaultOperatorName;if(i){e=d.getOperator(i)}else{const t=ut.call(this);const i=pt.call(this,t);e=d.getDefaultOperator(i)}if(e&&t.indexOf(e.name)<0){for(let i=0;i<t.length;i++){e=d.getOperator(t[i]);if(!e||e.exclude||!e.hasRequiredValues()){e=undefined}else{break}}}if(!e){e=d.getOperator(t[0])}return e}function rt(){const t=this.getConfig();let e=t&&t.operators;if(!e||e.length===0){e=d.getOperatorsForType(f.String)}return e}function dt(){let t;const e=rt.call(this);const i=ut.call(this);const n=pt.call(this,i);for(const i of e){const e=d.getOperator(i);if(!t){t=e.getGroup(n).id}else if(t!==e.getGroup(n).id){return true}}return false}function ct(){if(!this.oOperatorModel){return}const t=ut.call(this);const e=pt.call(this,t);const i=rt.call(this);const n=[];const s=dt.call(this);const a=this._sOperatorHelpId+"-pop-fl";const l=o.getElementById(a);const r=l.getBindingInfo("items");let c=r?.template;if(!c||l.getGroupable()!==s){if(s){c=new _({key:"{om>key}",text:"{om>text}",additionalText:"{om>additionalText}",groupKey:"{om>groupId}",groupText:"{om>groupText}"})}else{c=new _({key:"{om>key}",text:"{om>text}",additionalText:"{om>additionalText}"})}l.bindAggregation("items",{path:"om>/",templateShareable:false,template:c});l.setGroupable(s)}for(const o of i){const i=d.getOperator(o);if(!i||i.showInSuggest!==undefined&&i.showInSuggest==false){continue}const a=i.getLongText(e);const l=i.getGroup(e);let r=i.additionalInfo;if(r===undefined){if(r!==""&&i.formatRange){r=i.formatRange(i._getRange(undefined,t),t)}else if(!s){r=l.text}}let c=i.exclude?"2":"1";if(l.text&&l.id){c=l.id}n.push({key:i.name,text:a,additionalText:r,groupId:c,groupText:l.text})}l.destroyItems();this.oOperatorModel.setData();this.oOperatorModel.setData(n)}function ut(){const t=this.getConfig();let e=t&&t.dataType;if(!e){e=ht.call(this)}return e}function ht(){if(!this._oDefaultType){this._oDefaultType=new S}return this._oDefaultType}function pt(t){const e=t.getMetadata().getName();const i=t.getFormatOptions();const n=t.getConstraints();const s=this.getConfig().delegate;const o=this.getConfig().control;let a=s?s.getTypeMap(o).getBaseType(e,i,n):f.String;if(a===f.Unit){a=f.Numeric}return a}function gt(){const t=this.getConfig();const e=t.delegateName||"sap/ui/mdc/field/FieldBaseDelegate";const i=t.payload;return{name:e,payload:i}}function ft(t,e,i){const n=ut.call(this);const s=[];let o=0;for(o=0;o<t.length;o++){const e=t[o];const a=d.getOperator(e.operator);if(a&&a.valueTypes[0]===y.Static&&(e.values.length===0||i)){if(a.getStaticText){const t=a.getStaticText(n,pt.call(this,n));if(e.values.length>0){e.values[0]=t}else{e.values.push(t)}s.push(o)}}}if(e&&s.length>0){this.setProperty("conditions",t,true)}}function Ct(){const t=new w(this.getId()+"--ivtOperator",{text:"{$i18n>valuehelp.DEFINECONDITIONS_OPERATORLABEL}"});const e=new R(this.getId()+"-title",{text:{path:"$this>/label"}});const i=new M(this.getId()+"--prev",{icon:U.getIconURI("navigation-left-arrow"),tooltip:j.getText("PAGINGBUTTON_PREVIOUS"),visible:{path:"$this>/_pagination"},enabled:"{= ${$this>/inputOK} && ${$this>/_prevButtonActive}}",layoutData:new A({priority:z.NeverOverflow}),press:Rt.bind(this)});const n=new M(this.getId()+"--next",{icon:U.getIconURI("navigation-right-arrow"),tooltip:j.getText("PAGINGBUTTON_NEXT"),visible:{path:"$this>/_pagination"},enabled:"{= ${$this>/inputOK} && ${$this>/_nextButtonActive}}",layoutData:new A({priority:z.NeverOverflow}),press:Ft.bind(this)});const s=new M(this.getId()+"--removeAll",{text:j.getText("CONDITIONPANEL_REMOVE_ALL"),visible:{path:"$this>/_pagination"},layoutData:new A({priority:z.Low}),press:Ut.bind(this)});const o=new M(this.getId()+"--insert",{text:"{$i18n>valuehelp.DEFINECONDITIONS_ADDCONDITION}",visible:{path:"$this>/_pagination"},enabled:{path:"$this>/inputOK"},layoutData:new A({priority:z.Low}),press:Ht.bind(this)});const a=new F(this.getId()+"--pageCount",{text:kt.call(this),wrapping:false,textAlign:W.Center,visible:{path:"$this>/_pagination"},layoutData:new A({priority:z.NeverOverflow})});const l=new L(this.getId()+"--toolbar",{width:"100%",design:Y.Transparent,content:[e,new B,i,a,n,s,o]});const r=new $(this.getId()+"--panel",{headerToolbar:l,expanded:true,height:"100%",backgroundDesign:q.Transparent}).addStyleClass("sapMdcDefineconditionPanel");r.addDependent(new I(this._sOperatorHelpId,{typeahead:new m(this._sOperatorHelpId+"-pop",{content:[new O(this._sOperatorHelpId+"-pop-fl",{filterList:false,useFirstMatch:true})]})}));const d=new P(this.getId()+"--conditions",{width:"100%",hSpacing:0,vSpacing:0,containerQuery:true}).addStyleClass("sapUiMdcDefineConditionGrid");d.addDelegate({onAfterRendering:mt},false,this);bt.call(this,undefined,d,0,null,0);r.addContent(t);r.addContent(d);const c=new M(this.getId()+"--addBtn",{press:this.addCondition.bind(this),type:G.Default,text:"{$i18n>valuehelp.DEFINECONDITIONS_ADDCONDITION}",layoutData:new V({span:"XL2 L3 M3 S3",indent:"XL9 L8 M8 S7",linebreak:true,visibleS:{parts:[{path:"$this>/conditions"},{path:"$this>/config"}],formatter:yt.bind(this)},visibleM:{parts:[{path:"$this>/conditions"},{path:"$this>/config"}],formatter:yt.bind(this)},visibleL:{parts:[{path:"$this>/conditions"},{path:"$this>/config"}],formatter:yt.bind(this)},visibleXL:{parts:[{path:"$this>/conditions"},{path:"$this>/config"}],formatter:yt.bind(this)}})});d.addContent(c);d.attachValidateFieldGroup(Et,this);this.setAggregation("_content",r)}function yt(t,e){const i=e.hasOwnProperty("maxConditions")?e.maxConditions:-1;return i===-1||t.length<i}function vt(t,e){const i=e.hasOwnProperty("maxConditions")?e.maxConditions:-1;return i!==1}function It(){const t=this.getConditions();const e=this.byId("conditions");const i=this.byId("pageCount");let n;let s=-1;let o=0;let a=-1;const l=this._iShownConditions+this._iShownAdditionalConditions;for(let i=0;i<t.length&&s<l;i++){const r=t[i];const c=d.getOperator(r.operator);if(r.validated!==C.Validated||c.exclude){a++;if(a>=this._iStartIndex){s++;if(s<l){const t=this._oManagedObjectModel.getContext("/conditions/"+i+"/");if(!this.oOperatorModel){this.oOperatorModel=new T;this.setModel(this.oOperatorModel,"om");ct.call(this)}n=e.getContent();if(n[o]&&n[o].isA("sap.ui.mdc.Field")){o=Vt.call(this,r,e,o,t,s)}else{o=bt.call(this,r,e,o,t,s)}}}}}n=e.getContent();while(n[o]&&n[o]!==this.byId("addBtn")){n[o].destroy();o++}At.call(this,undefined);i.setText(kt.call(this));this.setProperty("_prevButtonActive",this._iStartIndex>0);this.setProperty("_nextButtonActive",s>=l);this.setProperty("_pagination",a>=l);this._bGridUpdated=true}function mt(){if(!this._bGridUpdated){return}const t=this.byId("conditions");const e=t.getContent();let i=0;if(this._bFocusLastCondition){i=_t.call(this,"-operator");e[i].focus();this._bFocusLastCondition=false}if(this._bFocusLastRemoveBtn){i=Ot.call(this,["-removeBtnLarge","-removeBtnSmall"]);e[i].focus();this._bFocusLastRemoveBtn=false}this._bGridUpdated=false}function Ot(t){const e=this.byId("conditions");const i=e.getContent();let n=i.length-1;if(!Array.isArray(t)){t=[t]}let s=0;let o=t[s];while(n>=0&&o!==undefined){const e=i[n];if(e.getId().endsWith(o)){const i=jQuery(e.getDomRef());if(i.is(":visible")){return n}else{s++;o=t[s]}}n--}return 0}function _t(t){const e=this.byId("conditions");const i=e.getContent();let n=i.length-1;const s=t;while(n>=0){const t=i[n];if(t.getId().endsWith(s)){return n}n--}return 0}function bt(t,e,i,n,s){const o=this.getId()+"--"+s;if(!this._oOperatorFieldType){this._oOperatorFieldType=new S({},{minLength:1})}const a=new v(o+"-operator",{value:{path:"$this>operator",type:this._oOperatorFieldType},width:"100%",display:g.Description,editMode:p.Editable,multipleLines:false,valueHelp:this._sOperatorHelpId,change:this.onSelectChange.bind(this),ariaLabelledBy:this.getId()+"--ivtOperator"}).setLayoutData(new V({span:{parts:[{path:"$this>/conditions"},{path:"$this>/config"}],formatter:Dt.bind(this)},linebreak:true})).setBindingContext(n,"$this");if(n){a.setFieldGroupIds([n.getPath()])}this._oObserver.observe(a,{properties:["value"]});e.insertContent(a,i);i++;const l=new w(o+"--ivtRemove",{text:{parts:[{path:"$this>"}],formatter:Tt.bind(this)}}).setLayoutData(new V({span:"XL1 L1 M1 S1",visibleS:false,visibleM:false,visibleL:false,visibleXL:false})).setBindingContext(n,"$this");const r=new M(o+"--removeBtnSmall",{press:this.removeCondition.bind(this),type:G.Transparent,icon:"sap-icon://decline",tooltip:"{$i18n>valuehelp.DEFINECONDITIONS_REMOVECONDITION}",ariaLabelledBy:l}).setLayoutData(new V({span:"XL1 L1 M1 S2",indent:{path:"$this>operator",formatter:St},visibleS:{parts:[{path:"$this>/conditions"},{path:"$this>/config"}],formatter:vt.bind(this)},visibleM:false,visibleL:false,visibleXL:false})).setBindingContext(n,"$this");if(n){r.setFieldGroupIds([n.getPath()])}e.insertContent(r,i);i++;if(t){for(let s=0;s<t.values.length;s++){const a=st.call(this,t,s,o+"-values"+s,n);if(a){e.insertContent(a,i);i++}}}const d=new M(o+"--removeBtnLarge",{press:this.removeCondition.bind(this),type:G.Transparent,icon:"sap-icon://decline",tooltip:"{$i18n>valuehelp.DEFINECONDITIONS_REMOVECONDITION}",ariaLabelledBy:l}).setLayoutData(new V({span:"XL1 L1 M1 S1",indent:{path:"$this>operator",formatter:St},visibleS:false,visibleM:{parts:[{path:"$this>/conditions"},{path:"$this>/config"}],formatter:vt.bind(this)},visibleL:{parts:[{path:"$this>/conditions"},{path:"$this>/config"}],formatter:vt.bind(this)},visibleXL:{parts:[{path:"$this>/conditions"},{path:"$this>/config"}],formatter:vt.bind(this)}})).setBindingContext(n,"$this");e.insertContent(d,i);i++;e.insertContent(l,i);i++;return i}function Tt(t){const e=k.getText("valuehelp.DEFINECONDITIONS_REMOVECONDITION_ARIALABEL_UNDEFINED");const i=this._oConditionType.formatValue(t);if(!t){return""}if(t.isEmpty||!i){return e}const n=k.getText("valuehelp.DEFINECONDITIONS_REMOVECONDITION_ARIALABEL",[i]);return n}function xt(t,e){if(!t){return this.getEditMode()}else if(e){return p.ReadOnly}const i=d.getOperator(t);let n=false;if(i&&i.valueTypes[0]===y.Static){n=true}return n?p.Display:p.Editable}function St(t){const e=t&&d.getOperator(t);if(!e||!e.valueTypes[0]||e.valueTypes[0]===y.Static&&!e.getStaticText){return"XL8 L8 M8 S0"}else{return""}}function Dt(t,e){const i=e.hasOwnProperty("maxConditions")?e.maxConditions:-1;let n="XL3 L3 M3 ";if(i===1){n+="S12"}else{n+="S10"}return n}function Nt(t,e){const i=e.hasOwnProperty("maxConditions")?e.maxConditions:-1;const n=t&&d.getOperator(t.operator);let s="";if(n&&n.valueTypes[1]){s="XL4 L4 M4 "}else{s="XL8 L8 M8 "}if(i===1){s+="S12"}else{s+="S10"}return s}function wt(t){const e=t&&d.getOperator(t);if(e&&e.aLabels){return e.aLabels[0]}else if(e&&e.valueTypes[1]){return k.getText("valuehelp.DEFINECONDITIONS_FROM")}else{return k.getText("valuehelp.DEFINECONDITIONS_VALUE")}}function Pt(t){const e=t&&d.getOperator(t);if(e&&e.aLabels){return e.aLabels[1]}else if(e&&e.valueTypes[1]){return k.getText("valuehelp.DEFINECONDITIONS_TO")}}function Vt(t,e,i,n,s){const o=this.getId()+"--"+s;let a=e.getContent();let l;const r=a[i];r.setBindingContext(n,"$this");if(n){r.setFieldGroupIds([n.getPath()])}if(r.getValueState()===X.Error&&!t.invalid){r.setValue(r.getValue());r.setValueState(X.None);r.setValueStateText()}i++;const d=a[i];d.setBindingContext(n,"$this");if(n){d.setFieldGroupIds([n.getPath()])}i++;let c;let u=a[i];let h;if(u.hasOwnProperty("_iValueIndex")&&u._iValueIndex===0){u.setValueHelp?.(it(t.operator)&&this._getValueHelp());if(t.values.length>0){c=this._oManagedObjectModel.getContext(n.getPath()+"values/0/");u.setBindingContext(c,"$this");u.setBindingContext(n,"$condition");if(u.getMetadata().hasProperty("value")&&(this._bUpdateType||!u.getBindingInfo("value"))){l=ot.call(this,t.operator,0);u.bindProperty("value",{path:"$this>",type:l})}i++;h=a[i];if(h.hasOwnProperty("_iValueIndex")&&h._iValueIndex===1){if(t.values.length>1){c=this._oManagedObjectModel.getContext(n.getPath()+"values/1/");h.setBindingContext(c,"$this");if(h.getMetadata().hasProperty("value")&&(this._bUpdateType||!h.getBindingInfo("value"))){l=ot.call(this,t.operator,1);h.bindProperty("value",{path:"$this>",type:l})}i++}else{h.destroy()}}else if(t.values.length>1){h=st.call(this,t,1,o+"-values1",n);if(h){e.insertContent(h,i);i++}}}else{u.destroy();u=undefined;h=a[i+1];if(h&&h.hasOwnProperty("_iValueIndex")&&h._iValueIndex===1){h.destroy()}}}else if(t.values.length>0){for(let s=0;s<t.values.length;s++){const a=st.call(this,t,s,o+"-values"+s,n);if(a){e.insertContent(a,i);i++}}}a=e.getContent();const p=a[i];p.setBindingContext(n,"$this");i++;const g=a[i];g.setBindingContext(n,"$this");i++;return i}function Et(t){if(this._bPendingChange){this._bPendingValidateCondition=true;return}let e=t.getSource();while(!(e.getParent()instanceof P)){e=e.getParent()}Lt.call(this,e)}function Mt(t,e){t.setValueState(X.Error);t.setValueStateText(e);$t(t)}function $t(t){const e=k.getText("valuehelp.DEFINECONDITIONS_REMOVECONDITION_ARIALABEL_INVALID");const i=tt(t);if(i){i.setText(e)}}function Lt(t){const e=t.getParent();let i=e.indexOfContent(t);let n;if(t.getId().endsWith("-operator")){n=t.getBindingContext("$this");i=i+2;t=e.getContent()[i]}else if(t.getId().endsWith("-removeBtnSmall")){n=t.getBindingContext("$this");i=i+1;t=e.getContent()[i]}else{n=t.getBindingContext("$condition")}let s;const o=n.getObject();const a=d.getOperator(o.operator);let l=!!o.invalid;if(!l&&a.valueTypes.length>0&&a.valueTypes[0]!==y.Static){if(a.valueTypes.length>1&&a.valueTypes[1]){if(t.hasOwnProperty("_iValueIndex")&&t._iValueIndex===0){s=e.getContent()[i+1]}else if(t.hasOwnProperty("_iValueIndex")&&t._iValueIndex===1){s=e.getContent()[i-1]}}if(t instanceof v&&!t.isInvalidInput()&&(!s||!s.isInvalidInput())){const e=t.getBinding("value").getType();try{a.validate(o.values,e);t.setValueState(X.None);t.setValueStateText();if(s&&s.getMetadata().getAllProperties().valueState){s.setValueState(X.None);s.setValueStateText()}}catch(e){l=true;Mt(t,e.message);if(s&&s.getMetadata().getAllProperties().valueState){Mt(s,e.message)}}}if(!l){const e=this.getConditions();const i=n.getPath();const a=parseInt(i.split("/")[2]);for(let i=0;i<e.length;i++){if(i!==a&&!o.isEmpty&&d.compareConditions(o,e[i])){l=true;Mt(t,k.getText("field.CONDITION_ALREADY_EXIST",[o.values[0]]));if(s&&s.getMetadata().getAllProperties().valueState){Mt(s,k.getText("field.CONDITION_ALREADY_EXIST",[o.values[1]]))}break}}}}At.call(this,l);this.fireConditionProcessed()}function At(t){let e=0;if(t!==true){const i=this.getConditions();for(e=0;e<i.length;e++){if(i[e].invalid){t=true;break}}}if(t!==true){const i=this.byId("conditions");const n=i.getContent();t=false;for(e=0;e<n.length;e++){const i=n[e];if(i.hasOwnProperty("_iValueIndex")&&(i instanceof v&&i.isInvalidInput()||i.getValueState&&i.getValueState()===X.Error)){if(i instanceof v&&!i.isInvalidInput()){let t=false;const e=i.getBindingContext("$condition");const n=e.getObject();const s=this.getConditions();const o=e.getPath();const a=parseInt(o.split("/")[2]);for(let e=0;e<s.length;e++){if(e!==a&&!n.isEmpty&&d.compareConditions(n,s[e])){t=true;break}}if(!t){i.setValueState(X.None);i.setValueStateText();continue}}t=true}}}this.setProperty("inputOK",!t,true)}function Bt(){return this.getConditions().filter(t=>{const e=d.getOperator(t.operator);return t.validated!==C.Validated||e.exclude})}function Ft(t){this._iStartIndex=this._iStartIndex+this._iShownConditions;this._iShownAdditionalConditions=0;It.call(this)}function Rt(t){this._iStartIndex=this._iStartIndex-this._iShownConditions;if(this._iStartIndex<0){this._iStartIndex=0}this._iShownAdditionalConditions=0;It.call(this)}function Ut(t){const e=this.getConditions().filter(t=>{const e=d.getOperator(t.operator);return t.validated===C.Validated&&!e.exclude});this.addDummyCondition(e.length+1);this._iStartIndex=0;this._iShownAdditionalConditions=0;this.setProperty("conditions",e,true);this.oInvisibleMessage.announce(k.getText("valuehelp.DEFINECONDITIONS_REMOVECONDITION_ANNOUNCE"),K.Assertive);this.fireConditionProcessed()}function Ht(t){const e=this.getConditions();const i=n({},this.getConfig());const s=i.maxConditions;const o=this.byId("conditions");const a=o.getContent();let l=0;let r=-1;for(const t of a){if(t instanceof v&&t.getValueHelp()===this._sOperatorHelpId){l++;if(l===1){const e=t.getBindingContext("$this");const i=e.getPath();const n=i.match(/^.*\/(\d+)\/$/);if(n){r=parseInt(n[1])}}}}if(s===-1||e.length<s){this.addDummyCondition(r);if(l>=this._iShownConditions){this._iShownAdditionalConditions++}}this.oInvisibleMessage.announce(k.getText("valuehelp.DEFINECONDITIONS_ADDCONDITION_ANNOUNCE"),K.Assertive)}function kt(){const t=Bt.call(this);const e=Math.ceil((t.length-this._iShownAdditionalConditions)/this._iShownConditions);const i=Math.floor(this._iStartIndex/this._iShownConditions)+1;const n=k.getText("valuehelp.PAGE_COUNT",[i,e]);return n}return J});
//# sourceMappingURL=DefineConditionPanel.js.map