/*!
 * OpenUI5
 * (c) Copyright 2026 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./TableTypeBase","./ActionLayoutData","./utils/Personalization","sap/ui/mdc/enums/TableGrowingMode","sap/ui/mdc/enums/TableRowActionType","sap/ui/mdc/enums/TablePopinDisplay","sap/ui/mdc/enums/TableActionPosition","sap/m/plugins/ColumnResizer","sap/m/SegmentedButton","sap/m/SegmentedButtonItem","sap/ui/Device","sap/ui/core/Element","sap/ui/core/Lib"],(t,e,o,n,i,s,a,r,l,u,p,c,h)=>{"use strict";let d;let g;let m;const f=t.extend("sap.ui.mdc.table.ResponsiveTableType",{metadata:{library:"sap.ui.mdc",properties:{growingMode:{type:"sap.ui.mdc.enums.TableGrowingMode",group:"Behavior",defaultValue:n.Basic},showDetailsButton:{type:"boolean",group:"Behavior",defaultValue:false},detailsButtonSetting:{type:"sap.ui.core.Priority[]",group:"Behavior"},popinLayout:{type:"sap.m.PopinLayout",group:"Appearance",defaultValue:"Block"},popinDisplay:{type:"sap.ui.mdc.enums.TablePopinDisplay",group:"Appearance",defaultValue:s.Inline}}}});f.prototype.setDetailsButtonSetting=function(t){return this.setProperty("detailsButtonSetting",t,true)};f.prototype.setParent=function(){t.prototype.setParent.apply(this,arguments);this._oShowDetailsButton?.destroy();delete this._oShowDetailsButton;return this};f.prototype.updateTableByProperty=function(t,e){const o=this.getInnerTable();if(!o){return}if(t==="growingMode"){o.setGrowingScrollToLoad(e===n.Scroll);o.setGrowing(e!==n.None)}else if(t==="showDetailsButton"){this._updateShowDetailsButton(o,e)}else if(t==="popinLayout"){o.setPopinLayout(e)}};f.prototype._updateShowDetailsButton=function(t,e){if(e&&!this._oShowDetailsButton){t.getHeaderToolbar().insertEnd(this._getShowDetailsButton(),0);t.attachEvent("popinChanged",T,this);t.setHiddenInPopin(this._getImportanceToHide())}else if(!e&&this._oShowDetailsButton){t.detachEvent("popinChanged",T,this);t.getHeaderToolbar().removeEnd(this._oShowDetailsButton);t.setHiddenInPopin([]);this._oShowDetailsButton.destroy();delete this._oShowDetailsButton}};f.prototype.loadModules=function(){if(!d){return new Promise((t,e)=>{sap.ui.require(["sap/m/Table","sap/m/Column","sap/m/ColumnListItem"],(e,o,n)=>{d=e;g=o;m=n;t()},()=>{e("Failed to load some modules")})})}else{return Promise.resolve()}};f.prototype.createTable=function(){const t=this.getTable();if(!t||!d){return null}return new d(this.getTableSettings())};f.prototype.getTableSettings=function(){const e=this.getTable();const o={...t.prototype.getTableSettings.apply(this,arguments),autoPopinMode:true,contextualWidth:"Auto",growing:true,sticky:["ColumnHeaders","GroupHeaders","HeaderToolbar","InfoToolbar"],growingThreshold:{path:"$sap.ui.mdc.Table>/threshold",formatter:function(t){return t>-1?t:undefined}},noData:e._getNoDataText(),headerToolbar:e._oToolbar,ariaLabelledBy:[e._oTitle],beforeOpenContextMenu:[w,this]};if(e.hasListeners("rowPress")){o.itemPress=[b,this]}return o};function b(t){this.callHook("RowPress",this.getTable(),{bindingContext:t.getParameter("listItem").getBindingContext(this.getInnerTable().getBindingInfo("items").model)});S.call(this,t)}function w(t){const e=t.getParameters();const o=this.getInnerTable();const n=c.getElementById(e.column?.getId().replace(/\-innerColumn$/,""));this.callHook("BeforeOpenContextMenu",this.getTable(),{bindingContext:e.listItem.getBindingContext(o.getBindingInfo("items").model),column:n,contextMenu:o.getContextMenu(),event:t,groupLevel:undefined})}f.prototype.createColumn=function(t){return new g(this.getColumnSettings(t))};f.prototype.getColumnSettings=function(e){const o=t.prototype.getColumnSettings.apply(this,arguments);o.header=e.getHeaderLabel({tooltip:o.tooltip,wrapping:{parts:[{path:"$sap.ui.mdc.table.Column>/headerVisible"},{path:"$sap.ui.mdc.Table>/enableColumnResize"}],formatter:function(t,e){return t&&!e}},wrappingType:"Hyphenated"});delete o.tooltip;return{...o,autoPopinWidth:"{$sap.ui.mdc.table.Column>/minWidth}",importance:{parts:[{path:"$sap.ui.mdc.table.Column>/extendedSettings/@className"},{path:"$sap.ui.mdc.table.Column>/extendedSettings/importance"},{path:"$sap.ui.mdc.table.Column>/importance"}],formatter:function(t,e,o){if(t==="sap.ui.mdc.table.ResponsiveColumnSettings"){return e}return o}},popinDisplay:{parts:[{path:"$sap.ui.mdc.table.Column>/headerVisible"},{path:"$sap.ui.mdc.Table#type>/popinDisplay"}],formatter:function(t,e){return t?e:"WithoutHeader"}},mergeDuplicates:{parts:[{path:"$sap.ui.mdc.table.Column>/extendedSettings/@className"},{path:"$sap.ui.mdc.table.Column>/extendedSettings/mergeFunction"}],formatter:function(t,e){return t==="sap.ui.mdc.table.ResponsiveColumnSettings"&&!!e}},mergeFunctionName:{parts:[{path:"$sap.ui.mdc.table.Column>/extendedSettings/@className"},{path:"$sap.ui.mdc.table.Column>/extendedSettings/mergeFunction"}],formatter:function(t,e){return t==="sap.ui.mdc.table.ResponsiveColumnSettings"?e:null}}}};f.prototype.createRowTemplate=function(t){return new m(t,this.getRowSettingsConfig())};f.prototype.prepareRowPress=function(){if(this._attachItemPress()){this.updateRowActions()}};f.prototype.cleanupRowPress=function(){if(this._detachItemPress()){this.updateRowActions()}};f.prototype.updateRowSettings=function(){const t=this.getTable();if(!t||!t._oRowTemplate){return}t._oRowTemplate.unbindProperty("navigated");t._oRowTemplate.unbindProperty("highlight");t._oRowTemplate.unbindProperty("highlightText");t._oRowTemplate.applySettings(this.getRowSettingsConfig());this.updateRowActions()};f.prototype.updateRowActions=function(){const t=this.getTable();const e=this.getRowActionsConfig();const o=t.hasListeners("rowPress")?"Active":"Inactive";t._oRowTemplate.unbindProperty("type");if(!t.getRowSettings()){t._oRowTemplate.setType(o);return}if(o==="Inactive"){this._detachItemPress()}let n;let s;let a;if("templateInfo"in e){const t=e.templateInfo;a=t.visible.formatter;s=typeof t.visible==="object";n=t.visible}else if(e&&e.items){if(e.items.length===0){t._oRowTemplate.setType(o);return}const i=e.items.find(t=>t.getType()==="Navigation");if(!i&&e.items.length>0){throw new Error("No row action of type 'Navigation' found. ResponsiveTableType only accepts row actions of type 'Navigation'.")}t._oRowTemplate.data("rowAction",i);s=i.isBound("visible");n=s?Object.assign({},i.getBindingInfo("visible")):i.getVisible();a=n.formatter}if(s){n.formatter=t=>{const e=a?a(t):t;const n=e===true?i.Navigation:o;if(n===i.Navigation){this._attachItemPress()}return n};t._oRowTemplate.bindProperty("type",n)}else{n=n?i.Navigation:o;t._oRowTemplate.setProperty("type",n);if(n===i.Navigation){this._attachItemPress()}}};f.prototype.enableColumnResize=function(){const t=this.getTable();const e=this.getInnerTable();if(!t||!e){return}let o=r.findOn(e);e.setFixedLayout("Strict");if(!o){o=new r;e.addDependent(o);o.attachColumnResize(y,this)}else{o.setEnabled(true);o.detachColumnResize(y,this);o.attachColumnResize(y,this)}};f.prototype.disableColumnResize=function(){const t=this.getTable();const e=this.getInnerTable();if(!t||!e){return}const o=r.findOn(e);if(o){o.setEnabled(false);o.detachColumnResize(y,this)}};function y(t){const e=this.getTable();const o=this.getInnerTable();const n=t.getParameter("column");const i=t.getParameter("width");const s=o.indexOfColumn(n);const a=e.getColumns()[s];this.callHook("ColumnResize",e,{column:a,width:i})}f.prototype.createColumnResizeMenuItem=function(t,e){const o=r.findOn(this.getInnerTable());if(!o){return}return o.getColumnResizeQuickAction(t.getInnerColumn(),e)};f.prototype.createColumnResizeInputMenuItem=function(t,e){const o=r.findOn(this.getInnerTable());if(!o){return}return o.getColumnResizeInputQuickAction(t.getInnerColumn(),e)};f.prototype._attachItemPress=function(){const t=this.getInnerTable();if(t&&!t.hasListeners("itemPress")){t.attachEvent("itemPress",b,this);return true}return false};f.prototype._detachItemPress=function(){const t=this.getTable();const e=this.getInnerTable();if(!t.hasListeners("rowPress")&&e){e.detachEvent("itemPress",b,this);return true}return false};f.prototype.setShowDetailsButton=function(t){if(this.getShowDetailsButton()!==t){this.setProperty("showDetailsButton",t,true);this.getTable()?._updateAdaptation()}return this};f.prototype._setShowDetailsState=function(t,e){if(t===this.bShowDetails){return}this.bShowDetails=t;if(!e){this._persistShowDetails(t)}if(!this._oShowDetailsButton){return}const o=this.getInnerTable();if(this.bShowDetails){o.setHiddenInPopin();this._oShowDetailsButton.setSelectedKey("showDetails")}else{o.setHiddenInPopin(this._getImportanceToHide());this._oShowDetailsButton.setSelectedKey("hideDetails")}};f.prototype._getShowDetailsButton=function(){if(!this._oShowDetailsButton){const t=h.getResourceBundleFor("sap.ui.mdc");const o=this.getTable().getId();this.bShowDetails=false;this._oShowDetailsButton=new l(o+"-showHideDetails",{visible:false,selectedKey:"hideDetails",items:[new u({id:o+"-showDetails",icon:"sap-icon://detail-more",key:"showDetails",tooltip:t.getText("table.SHOWDETAILS_TEXT"),press:[function(){this._setShowDetailsState(true)},this]}),new u({id:o+"-hideDetails",icon:"sap-icon://detail-less",key:"hideDetails",tooltip:t.getText("table.HIDEDETAILS_TEXT"),press:[function(){this._setShowDetailsState(false)},this]})],layoutData:new e({position:a.PersonalizationActionsShowHideDetails})})}return this._oShowDetailsButton};f.prototype._persistShowDetails=function(t){o.createShowDetailsChange(this.getTable(),{showDetails:t})};f.prototype._getImportanceToHide=function(){const t=this.getDetailsButtonSetting()||[];if(t.length>0){return t}else{return p.system.phone?["Low","Medium"]:["Low"]}};function T(t){const e=t.getParameter("hasPopin");const o=t.getParameter("hiddenInPopin");const n=t.getSource().getVisibleItems().length;if(n&&(o.length||e&&this.bShowDetails)){this._oShowDetailsButton.setVisible(true)}else{this._oShowDetailsButton.setVisible(false)}}function S(t){const e=this.getTable();const o=t.getParameter("listItem");if(o.getType()!=="Navigation"){return}const n=e.getRowSettings();const i=n.getAllActions();if(n.isBound("rowActions")){const t=i.items.model;if(!this._oRowActionItem){this._oRowActionItem=i.items.template.clone()}this._oRowActionItem.setModel(e.getModel(t),t);n.addDependent(this._oRowActionItem)}else{this._oRowActionItem=o.data("rowAction")}this._oRowActionItem.setType("Navigation");this.callHook("Press",this._oRowActionItem,{bindingContext:o.getBindingContext(this.getInnerTable().getBindingInfo("items").model)})}f.prototype.removeToolbar=function(){const t=this.getInnerTable();if(t){t.setHeaderToolbar()}};f.prototype.scrollToIndex=function(t){const e=this.getInnerTable();if(e){return e.scrollToIndex(t)}else{return Promise.reject()}};f.prototype.getRowBinding=function(){const t=this.getInnerTable();return t?t.getBinding("items"):undefined};f.prototype.bindRows=function(t){const e=this.getInnerTable();if(e){e.bindItems(t)}};f.prototype.isTableBound=function(){const t=this.getInnerTable();if(t){return t.isBound("items")}else{return false}};f.prototype.insertFilterInfoBar=function(t,e){const o=this.getInnerTable();if(o){o.setInfoToolbar(t);if(!o.getAriaLabelledBy().includes(e)){o.addAriaLabelledBy(e)}}};f.prototype.updateSortIndicator=function(t,e){t.getInnerColumn().setSortIndicator(e)};f.prototype._onColumnInsert=function(t){const e=this.getTable();const n=this.getInnerTable();if(o.isUserPersonalizationActive(e)&&n.getHiddenInPopin()?.includes(t.getInnerColumn().getImportance())&&e.getColumns().pop()===t){this._setShowDetailsState(true)}};f.prototype.onModifications=function(){const t=this.getTable();const e=t._getXConfig();const o=e?.aggregations?.type;this._setShowDetailsState(o?.ResponsiveTable?.showDetails??false,true)};f.prototype.showXConfigState=function(){return this.getShowDetailsButton()};f.prototype.exit=function(){t.prototype.exit.apply(this,arguments);this._oShowDetailsButton?.destroy();delete this._oShowDetailsButton};return f});
//# sourceMappingURL=ResponsiveTableType.js.map