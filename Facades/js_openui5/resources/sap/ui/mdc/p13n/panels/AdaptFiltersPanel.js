/*!
 * OpenUI5
 * (c) Copyright 2026 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/m/p13n/AbstractContainer","sap/m/p13n/AbstractContainerItem","sap/m/p13n/SelectionPanel","./GroupView","./AdaptFiltersPanelContent","sap/ui/core/Lib","sap/ui/model/Filter","sap/m/Button","sap/m/Bar","sap/m/IconTabBar","sap/m/IconTabFilter","sap/m/ToolbarSpacer","sap/m/Select","sap/m/SegmentedButton","sap/m/SegmentedButtonItem","sap/ui/core/InvisibleText","sap/m/SearchField","sap/ui/core/Item","sap/m/library","sap/ui/model/json/JSONModel"],(e,t,i,s,n,o,r,h,a,c,l,d,u,_,g,p,w,y,f,S)=>{"use strict";const{BarDesign:I}=f;const V=e.extend("sap.ui.mdc.p13n.panels.AdaptFiltersPanel",{metadata:{library:"sap.ui.mdc",properties:{itemFactory:{type:"function"},enableReorder:{type:"boolean",defaultValue:true}},events:{change:{}}},renderer:{apiVersion:2}});V.prototype.GROUP_KEY="group";V.prototype.LIST_KEY="list";V.prototype.P13N_MODEL="$p13n";V.prototype.getVerticalScrolling=function(){return true};V.prototype.applySettings=function(o){const r=e=>function(t){if(this._checkIsNewUI()){this.fireChange(t.getParameters())}else{this.fireChange()}this.getP13nModel().setProperty(e,t.getSource().getP13nData())}.bind(this);let h,a;if(this._checkIsNewUI()){h=new n(this.getId()+"-listView",{change:r("/items")});a=new n(this.getId()+"-groupView",{defaultView:this.GROUP_KEY,change:r("/items")})}else{h=new i(this.getId()+"-listView",{activeColumn:this._getResourceText("p13nDialog.LIST_VIEW_ACTIVE"),change:r("/items")});a=new s(this.getId()+"-groupView",{change:r("/itemsGrouped")})}this.addView(new t({key:this.LIST_KEY,content:h}));this.addView(new t({key:this.GROUP_KEY,content:a}));e.prototype.applySettings.apply(this,arguments);this.getView(this.LIST_KEY).getContent().setEnableReorder(this.getEnableReorder());this._createHeader();this.addStyleClass("sapUiMDCAdaptFiltersPanel")};V.prototype.setItemFactory=function(e){this.setProperty("itemFactory",e);this.getViews().forEach(t=>{const i=t.getContent();i.setItemFactory(e)});return this};V.prototype.switchView=function(t){const i=this.getCurrentViewKey();if(!this._isCustomView(t)){this.getCurrentViewContent()._bInactive=true}if(this._checkIsNewUI()&&i){const e=this.getCurrentViewContent();if(e){const t=e.getP13nData();if(t&&this.getP13nModel()){this.getP13nModel().setProperty("/items",t)}}}e.prototype.switchView.call(this,t);const s=this.getCurrentViewContent();if(this._checkIsNewUI()){this._getViewSwitch()?.setSelectedKey(this.getCurrentViewKey());if(s&&this.getP13nModel()){s.setP13nData(this.getP13nModel().getProperty("/items"))}if(s._getSearchField){let e;if(i){e=this.getView(i).getContent()._getSearchField?.().getValue()}s._getSearchField?.().setValue(e)}this._filterByModeAndSearch();this.oLayout.insertContent(this._oHeader,0);if(t===this.GROUP_KEY){if(s._updateFilterFieldsEditMode){s._updateFilterFieldsEditMode("edit")}}else if(t===this.LIST_KEY){if(s._oViewModel){const e=s._oViewModel.getProperty("/editable");const t=e?"edit":"sort";s._updateFilterFieldsEditMode(t)}}}else{this._getShowHideBtn().setVisible(!this._isCustomView());this._getViewSwitch().setSelectedKey(this.getCurrentViewKey());if(!this._isCustomView(t)){s._bInactive=false;this.showFactory(s._getShowFactory())}this._filterByModeAndSearch()}};V.prototype.addCustomView=function(e){const i=e.item;const s=i.getKey();const n=e.content;const o=e.search;const r=e.selectionChange;const h=e.filterSelect;if(!s){throw new Error("Please provide an item of type sap.m.SegmentedButtonItem with a key")}const a=this._getViewSwitch();if(a){const e=this._checkIsNewUI()?"select":"selectionChange";a.attachEvent(e,e=>{if(r){r(e.getParameter("item").getKey())}if(this._isCustomView()){if(o instanceof Function){o(this._getSearchField().getValue())}if(h instanceof Function){h(this._getQuickFilter().getSelectedKey())}}})}if(o instanceof Function){this._getSearchField().attachLiveChange(e=>{if(this._isCustomView()){o(this._getSearchField().getValue())}})}if(h instanceof Function){this._getQuickFilter().attachChange(e=>{if(this._isCustomView()){h(this._getQuickFilter().getSelectedKey())}})}this.addView(new t({key:s,content:n.addStyleClass("sapUiMDCPanelPadding")}));if(this._checkIsNewUI()){a.addItem(new l({key:s,text:i.getText(),icon:i.getIcon()}))}else{a.addItem(i)}};V.prototype.showFactory=function(e){if(this.getCurrentViewContent().showFactory){this.getCurrentViewContent().showFactory(e)}};V.prototype.getSelectedFields=function(){return this.getCurrentViewContent().getSelectedFields()};V.prototype.setGroupExpanded=function(e,t){this.getView(this.GROUP_KEY).getContent().setGroupExpanded(e,t)};V.prototype.setP13nModel=function(e){this.setModel(e,this.P13N_MODEL);const t="/items";let i="/itemsGrouped";if(this._checkIsNewUI()){i="/items"}this.getView(this.LIST_KEY).getContent().setP13nData(e.getProperty(t));this.getView(this.GROUP_KEY).getContent().setP13nData(e.getProperty(i));this._filterByModeAndSearch()};V.prototype.setP13nData=function(e){const t=this.getP13nModel();if(!t){this.setP13nModel(new S(e))}else{const i="/items";let s="/itemsGrouped";if(this._checkIsNewUI()){s="/items"}t.setData(e);this.getView(this.LIST_KEY).getContent().setP13nData(t.getProperty(i));this.getView(this.GROUP_KEY).getContent().setP13nData(t.getProperty(s))}};V.prototype.restoreDefaults=function(){if(this._checkIsNewUI()){this.switchView(this.LIST_KEY);this.getView(this.getCurrentViewKey()).getContent().restoreDefaults();return}this._sModeKey="all";this._getQuickFilter().setSelectedKey(this._sModeKey);this._getSearchField().setValue("");this._filterByModeAndSearch();if(this.getCurrentViewKey()===this.LIST_KEY){this._getShowHideBtn().setText(this._getResourceText("filterbar.ADAPT_SHOW_VALUE"));this.showFactory(false)}};V.prototype.getP13nModel=function(){return this.getModel(this.P13N_MODEL)};V.prototype._createHeader=function(){if(this._oHeader){return this._oHeader}if(this._checkIsNewUI()){this._oHeader=new c({selectedKey:this.LIST_KEY,applyContentPadding:false,expandable:false,items:[new l({key:this.LIST_KEY,text:this._getResourceText("adaptFiltersPanel.LIST")}),new l({key:this.GROUP_KEY,text:this._getResourceText("adaptFiltersPanel.GROUP")})],select:e=>{const t=e.getParameter("key");this.switchView(t)}});this.oLayout.insertContent(this._oHeader,0);this.oLayout.setShowHeader(false)}else{const e=this._getQuickFilter();const t=this._getViewSwitch();const i=this._getShowHideBtn();this._oHeader=new a({contentMiddle:[e,new d,i,t]});this._oHeader.setDesign(I.SubHeader);const s=new a({contentMiddle:[this._getSearchField()]}).addStyleClass("sapUiMDCAdaptFiltersSearchBar");s.setDesign(I.SubHeader);this.setSubHeader(s);this.setHeader(this._oHeader)}return this._oHeader};V.prototype._getShowHideBtn=function(){if(this._checkIsNewUI()){return}const e=this._getResourceText("filterbar.ADAPT_SHOW_VALUE");const t=this._getResourceText("filterbar.ADAPT_HIDE_VALUE");if(!this._oShowHideBtn){this._oShowHideBtn=new h({press:function(i){this.showFactory(!this.getCurrentViewContent()._getShowFactory());const s=i.oSource;const n=s.getText()===e?t:e;s.setText(n)}.bind(this)})}this._oShowHideBtn.setText(!this._isCustomView()&&this.getCurrentViewContent()._getShowFactory()?t:e);return this._oShowHideBtn};V.prototype._getQuickFilter=function(){if(!this._oGroupModeSelect){this._oGroupModeSelect=new u({items:[new y({key:"all",text:this._getResourceText("p13nDialog.GROUPMODE_ALL")}),new y({key:"visible",text:this._getResourceText("p13nDialog.GROUPMODE_VISIBLE")}),new y({key:"active",text:this._getResourceText("p13nDialog.GROUPMODE_ACTIVE")}),new y({key:"visibleactive",text:this._getResourceText("p13nDialog.GROUPMODE_VISIBLE_ACTIVE")}),new y({key:"mandatory",text:this._getResourceText("p13nDialog.GROUPMODE_MANDATORY")})],tooltip:this._getResourceText("p13nDialog.QUICK_FILTER"),change:this._onGroupModeChange.bind(this)})}return this._oGroupModeSelect};V.prototype._getSearchField=function(){if(this._checkIsNewUI()){return this.getCurrentViewContent()._getSearchField?.()}if(!this._oSearchField){this._oSearchField=new w(this.getId()+"-searchField",{liveChange:[this._filterByModeAndSearch,this],width:"100%"});this._oSearchField.setPlaceholder(this._getResourceText("p13nDialog.ADAPT_FILTER_SEARCH"))}return this._oSearchField};V.prototype.getInitialFocusedControl=function(){return this._getSearchField()};V.prototype._onGroupModeChange=function(e){this._sModeKey=e.getParameters().selectedItem.getKey();this._filterByModeAndSearch()};V.prototype._getViewSwitch=function(){if(this._checkIsNewUI()){return this._oHeader}if(!this._oViewSwitch){this._oViewSwitch=new _({items:[new g({tooltip:this._getResourceText("filterbar.ADAPT_LIST_VIEW"),icon:"sap-icon://list",key:this.LIST_KEY}),new g({tooltip:this._getResourceText("filterbar.ADAPT_GROUP_VIEW"),icon:"sap-icon://group-2",key:this.GROUP_KEY})],selectionChange:function(e){if(this.getCurrentViewKey()===this.LIST_KEY){this.getCurrentViewContent()._removeMoveButtons()}const t=e.getParameter("item").getKey();this.switchView(t)}.bind(this)});this._oInvText=new p({text:this._getResourceText("p13nDialog.VIEW_SWITCH")}).toStatic();this._oViewSwitch.addAriaLabelledBy(this._oInvText)}return this._oViewSwitch};V.prototype._isCustomView=function(){return this._sCurrentView!=this.GROUP_KEY&&this._sCurrentView!=this.LIST_KEY};V.prototype._filterByModeAndSearch=function(){if(this._checkIsNewUI()){this.getCurrentViewContent()._filterByModeAndSearch?.();return}if(this._isCustomView(this.getCurrentViewKey())){return}this._sSearchString=this._getSearchField().getValue();const e=this._createFilterQuery();this._getSearchField().setValue(this._sSearchString);this.getCurrentViewContent().filterContent(e);return e};V.prototype._getResourceText=function(e){return o.getResourceBundleFor("sap.ui.mdc").getText(e)};V.prototype._createFilterQuery=function(){let e=[],t=[],i=[];if(this._sSearchString){e=[new r("label","Contains",this._sSearchString),new r("tooltip","Contains",this._sSearchString)];i=new r(e,false)}switch(this._sModeKey){case"visible":t=new r("visible","EQ",true);break;case"active":t=new r("active","EQ",true);break;case"mandatory":t=new r("required","EQ",true);break;case"visibleactive":t=new r([new r("active","EQ",true),new r("visible","EQ",true)],true);break;default:}const s=new r("visibleInDialog","EQ",true);return new r([].concat(i,t,s),true)};V.prototype._checkIsNewUI=function(){if(this._bUseNewUI===undefined){this._bUseNewUI=new URLSearchParams(window.location.search).get("sap-ui-xx-new-adapt-filters")==="true"}return this._bUseNewUI};V.prototype.exit=function(){e.prototype.exit.apply(this,arguments);this._sModeKey=null;this._sSearchString=null;if(this._oInvText){this._oInvText.destroy();this._oInvText=null}};return V});
//# sourceMappingURL=AdaptFiltersPanel.js.map